!function(o,e,t,s){"use strict";var i=o.fn.twbsPagination,r=function(t,s){if(this.$element=o(t),this.options=o.extend({},o.fn.twbsPagination.defaults,s),this.options.startPage<1||this.options.startPage>this.options.totalPages)throw new Error("Start page option is incorrect");if(this.options.totalPages=parseInt(this.options.totalPages),isNaN(this.options.totalPages))throw new Error("Total pages option is not correct!");if(this.options.visiblePages=parseInt(this.options.visiblePages),isNaN(this.options.visiblePages))throw new Error("Visible pages option is not correct!");if(this.options.beforePageClick instanceof Function&&this.$element.first().on("beforePage",this.options.beforePageClick),this.options.onPageClick instanceof Function&&this.$element.first().on("page",this.options.onPageClick),this.options.hideOnlyOnePage&&1==this.options.totalPages)return this.options.initiateStartPageClick&&this.$element.trigger("page",1),this;if(this.options.href&&(this.options.startPage=this.getPageFromQueryString(),this.options.startPage||(this.options.startPage=1)),"UL"===("function"==typeof this.$element.prop?this.$element.prop("tagName"):this.$element.attr("tagName")))this.$listContainer=this.$element;else{var e=this.$element,i=o([]);e.each(function(t){var s=o("<ul></ul>");o(this).append(s),i.push(s[0])}),this.$listContainer=i,this.$element=i}return this.$listContainer.addClass(this.options.paginationClass),this.options.initiateStartPageClick?this.show(this.options.startPage):(this.currentPage=this.options.startPage,this.render(this.getPages(this.options.startPage)),this.setupEvents()),this};r.prototype={constructor:r,destroy:function(){return this.$element.empty(),this.$element.removeData("twbs-pagination"),this.$element.off("page"),this},show:function(t){if(t<1||t>this.options.totalPages)throw new Error("Page is incorrect.");this.currentPage=t,this.$element.trigger("beforePage",t);var s=this.getPages(t);return this.render(s),this.setupEvents(),this.$element.trigger("page",t),s},enable:function(){this.show(this.currentPage)},disable:function(){var t=this;this.$listContainer.off("click").on("click","li",function(t){t.preventDefault()}),this.$listContainer.children().each(function(){o(this).hasClass(t.options.activeClass)||o(this).addClass(t.options.disabledClass)})},buildListItems:function(t){var s=[];if(this.options.first&&s.push(this.buildItem("first",1)),this.options.prev){var e=1<t.currentPage?t.currentPage-1:this.options.loop?this.options.totalPages:1;s.push(this.buildItem("prev",e))}for(var i=0;i<t.numeric.length;i++)s.push(this.buildItem("page",t.numeric[i]));if(this.options.next){var a=t.currentPage<this.options.totalPages?t.currentPage+1:this.options.loop?1:this.options.totalPages;s.push(this.buildItem("next",a))}return this.options.last&&s.push(this.buildItem("last",this.options.totalPages)),s},buildItem:function(t,s){var e=o("<li></li>"),i=o("<a></a>"),a=this.options[t]?this.makeText(this.options[t],s):s;return e.addClass(this.options[t+"Class"]),e.data("page",s),e.data("page-type",t),e.append(i.attr("href",this.makeHref(s)).addClass(this.options.anchorClass).html(a)),e},getPages:function(t){var s=[],e=Math.floor(this.options.visiblePages/2),i=t-e+1-this.options.visiblePages%2,a=t+e,n=this.options.visiblePages;n>this.options.totalPages&&(n=this.options.totalPages),i<=0&&(i=1,a=n),a>this.options.totalPages&&(i=this.options.totalPages-n+1,a=this.options.totalPages);for(var o=i;o<=a;)s.push(o),o++;return{currentPage:t,numeric:s}},render:function(s){var e=this;this.$listContainer.children().remove();var t=this.buildListItems(s);o.each(t,function(t,s){e.$listContainer.append(s)}),this.$listContainer.children().each(function(){var t=o(this);switch(t.data("page-type")){case"page":t.data("page")===s.currentPage&&t.addClass(e.options.activeClass);break;case"first":t.toggleClass(e.options.disabledClass,1===s.currentPage);break;case"last":t.toggleClass(e.options.disabledClass,s.currentPage===e.options.totalPages);break;case"prev":t.toggleClass(e.options.disabledClass,!e.options.loop&&1===s.currentPage);break;case"next":t.toggleClass(e.options.disabledClass,!e.options.loop&&s.currentPage===e.options.totalPages)}})},setupEvents:function(){var e=this;this.$listContainer.off("click").on("click","li",function(t){var s=o(this);if(s.hasClass(e.options.disabledClass)||s.hasClass(e.options.activeClass))return!1;!e.options.href&&t.preventDefault(),e.show(parseInt(s.data("page")))})},changeTotalPages:function(t,s){return this.options.totalPages=t,this.show(s)},makeHref:function(t){return this.options.href?this.generateQueryString(t):"#"},makeText:function(t,s){return t.replace(this.options.pageVariable,s).replace(this.options.totalPagesVariable,this.options.totalPages)},getPageFromQueryString:function(t){var s=this.getSearchString(t),e=new RegExp(this.options.pageVariable+"(=([^&#]*)|&|#|$)").exec(s);return e&&e[2]?(e=decodeURIComponent(e[2]),e=parseInt(e),isNaN(e)?null:e):null},generateQueryString:function(t,s){var e=this.getSearchString(s),i=new RegExp(this.options.pageVariable+"=*[^&#]*");return e?"?"+e.replace(i,this.options.pageVariable+"="+t):""},getSearchString:function(t){var s=t||e.location.search;return""===s?null:(0===s.indexOf("?")&&(s=s.substr(1)),s)},getCurrentPage:function(){return this.currentPage},getTotalPages:function(){return this.options.totalPages}},o.fn.twbsPagination=function(t){var s,e=Array.prototype.slice.call(arguments,1),i=o(this),a=i.data("twbs-pagination"),n="object"==typeof t?t:{};return a||i.data("twbs-pagination",a=new r(this,n)),"string"==typeof t&&(s=a[t].apply(a,e)),void 0===s?i:s},o.fn.twbsPagination.defaults={totalPages:1,startPage:1,visiblePages:5,initiateStartPageClick:!0,hideOnlyOnePage:!1,href:!1,pageVariable:"{{page}}",totalPagesVariable:"{{total_pages}}",page:null,first:"First",prev:"Previous",next:"Next",last:"Last",loop:!1,beforePageClick:null,onPageClick:null,paginationClass:"pagination",nextClass:"page-item next",prevClass:"page-item prev",lastClass:"page-item last",firstClass:"page-item first",pageClass:"page-item",activeClass:"active",disabledClass:"disabled",anchorClass:"page-link"},o.fn.twbsPagination.Constructor=r,o.fn.twbsPagination.noConflict=function(){return o.fn.twbsPagination=i,this},o.fn.twbsPagination.version="1.4.2"}(window.jQuery,window,document);(function(g,j){var b=function(a){return new i(a)};b.version="0.1.3";var c=g.fxSetup||{rates:{},base:""};b.rates=c.rates;b.base=c.base;b.settings={from:c.from||b.base,to:c.to||b.base};var h=b.convert=function(a,e){if("object"===typeof a&&a.length){for(var d=0;d<a.length;d++)a[d]=h(a[d],e);return a}e=e||{};if(!e.from)e.from=b.settings.from;if(!e.to)e.to=b.settings.to;var d=e.to,c=e.from,f=b.rates;f[b.base]=1;if(!f[d]||!f[c])throw"fx error";d=c===b.base?f[d]:d===b.base?1/f[c]:f[d]*(1/f[c]);return a*d},i=function(a){"string"===typeof a?(this._v=parseFloat(a.replace(/[^0-9-.]/g,"")),this._fx=a.replace(/([^A-Za-z])/g,"")):this._v=a},c=b.prototype=i.prototype;c.convert=function(){var a=Array.prototype.slice.call(arguments);a.unshift(this._v);return h.apply(b,a)};c.from=function(a){a=b(h(this._v,{from:a,to:b.base}));a._fx=b.base;return a};c.to=function(a){return h(this._v,{from:this._fx?this._fx:b.settings.from,to:a})};if("undefined"!==typeof exports){if("undefined"!==typeof module&&module.exports)exports=module.exports=b;exports.fx=fx}else"function"===typeof define&&define.amd?define([],function(){return b}):(b.noConflict=function(a){return function(){g.fx=a;b.noConflict=j;return b}}(g.fx),g.fx=b)})(this);(function($){$.extend({validNumber:function(value){if(value=="00"){value="0";}
if(value==="."){value="0.";}
if(!value.includes(".")){value=parseFloat(value).toString();}
if(!(/^[-]?\d+[.]?\d*$/).test(value)){value=value.substring(0,value.length-1);}
return value;}});})(jQuery);!function(a,b){"function"==typeof define&&define.amd?define(b):"object"==typeof module&&module.exports?module.exports=b():a.numeral=b()}(this,function(){function a(a,b){this._input=a,this._value=b}var b,c,d="2.0.6",e={},f={},g={currentLocale:"en",zeroFormat:null,nullFormat:null,defaultFormat:"0,0",scalePercentBy100:!0},h={currentLocale:g.currentLocale,zeroFormat:g.zeroFormat,nullFormat:g.nullFormat,defaultFormat:g.defaultFormat,scalePercentBy100:g.scalePercentBy100};return b=function(d){var f,g,i,j;if(b.isNumeral(d))f=d.value();else if(0===d||"undefined"==typeof d)f=0;else if(null===d||c.isNaN(d))f=null;else if("string"==typeof d)if(h.zeroFormat&&d===h.zeroFormat)f=0;else if(h.nullFormat&&d===h.nullFormat||!d.replace(/[^0-9]+/g,"").length)f=null;else{for(g in e)if(j="function"==typeof e[g].regexps.unformat?e[g].regexps.unformat():e[g].regexps.unformat,j&&d.match(j)){i=e[g].unformat;break}i=i||b._.stringToNumber,f=i(d)}else f=Number(d)||null;return new a(d,f)},b.version=d,b.isNumeral=function(b){return b instanceof a},b._=c={numberToFormat:function(a,c,d){var e,g,h,i,j,k,l,m=f[b.options.currentLocale],n=!1,o=!1,p=0,q="",r=1e12,s=1e9,t=1e6,u=1e3,v="",w=!1;if(a=a||0,g=Math.abs(a),b._.includes(c,"(")?(n=!0,c=c.replace(/[\(|\)]/g,"")):(b._.includes(c,"+")||b._.includes(c,"-"))&&(j=b._.includes(c,"+")?c.indexOf("+"):0>a?c.indexOf("-"):-1,c=c.replace(/[\+|\-]/g,"")),b._.includes(c,"a")&&(e=c.match(/a(k|m|b|t)?/),e=e?e[1]:!1,b._.includes(c," a")&&(q=" "),c=c.replace(new RegExp(q+"a[kmbt]?"),""),g>=r&&!e||"t"===e?(q+=m.abbreviations.trillion,a/=r):r>g&&g>=s&&!e||"b"===e?(q+=m.abbreviations.billion,a/=s):s>g&&g>=t&&!e||"m"===e?(q+=m.abbreviations.million,a/=t):(t>g&&g>=u&&!e||"k"===e)&&(q+=m.abbreviations.thousand,a/=u)),b._.includes(c,"[.]")&&(o=!0,c=c.replace("[.]",".")),h=a.toString().split(".")[0],i=c.split(".")[1],k=c.indexOf(","),p=(c.split(".")[0].split(",")[0].match(/0/g)||[]).length,i?(b._.includes(i,"[")?(i=i.replace("]",""),i=i.split("["),v=b._.toFixed(a,i[0].length+i[1].length,d,i[1].length)):v=b._.toFixed(a,i.length,d),h=v.split(".")[0],v=b._.includes(v,".")?m.delimiters.decimal+v.split(".")[1]:"",o&&0===Number(v.slice(1))&&(v="")):h=b._.toFixed(a,0,d),q&&!e&&Number(h)>=1e3&&q!==m.abbreviations.trillion)switch(h=String(Number(h)/1e3),q){case m.abbreviations.thousand:q=m.abbreviations.million;break;case m.abbreviations.million:q=m.abbreviations.billion;break;case m.abbreviations.billion:q=m.abbreviations.trillion}if(b._.includes(h,"-")&&(h=h.slice(1),w=!0),h.length<p)for(var x=p-h.length;x>0;x--)h="0"+h;return k>-1&&(h=h.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1"+m.delimiters.thousands)),0===c.indexOf(".")&&(h=""),l=h+v+(q?q:""),n?l=(n&&w?"(":"")+l+(n&&w?")":""):j>=0?l=0===j?(w?"-":"+")+l:l+(w?"-":"+"):w&&(l="-"+l),l},stringToNumber:function(a){var b,c,d,e=f[h.currentLocale],g=a,i={thousand:3,million:6,billion:9,trillion:12};if(h.zeroFormat&&a===h.zeroFormat)c=0;else if(h.nullFormat&&a===h.nullFormat||!a.replace(/[^0-9]+/g,"").length)c=null;else{c=1,"."!==e.delimiters.decimal&&(a=a.replace(/\./g,"").replace(e.delimiters.decimal,"."));for(b in i)if(d=new RegExp("[^a-zA-Z]"+e.abbreviations[b]+"(?:\\)|(\\"+e.currency.symbol+")?(?:\\))?)?$"),g.match(d)){c*=Math.pow(10,i[b]);break}c*=(a.split("-").length+Math.min(a.split("(").length-1,a.split(")").length-1))%2?1:-1,a=a.replace(/[^0-9\.]+/g,""),c*=Number(a)}return c},isNaN:function(a){return"number"==typeof a&&isNaN(a)},includes:function(a,b){return-1!==a.indexOf(b)},insert:function(a,b,c){return a.slice(0,c)+b+a.slice(c)},reduce:function(a,b){if(null===this)throw new TypeError("Array.prototype.reduce called on null or undefined");if("function"!=typeof b)throw new TypeError(b+" is not a function");var c,d=Object(a),e=d.length>>>0,f=0;if(3===arguments.length)c=arguments[2];else{for(;e>f&&!(f in d);)f++;if(f>=e)throw new TypeError("Reduce of empty array with no initial value");c=d[f++]}for(;e>f;f++)f in d&&(c=b(c,d[f],f,d));return c},multiplier:function(a){var b=a.toString().split(".");return b.length<2?1:Math.pow(10,b[1].length)},correctionFactor:function(){var a=Array.prototype.slice.call(arguments);return a.reduce(function(a,b){var d=c.multiplier(b);return a>d?a:d},1)},toFixed:function(a,b,c,d){var e,f,g,h,i=a.toString().split("."),j=b-(d||0);return e=2===i.length?Math.min(Math.max(i[1].length,j),b):j,g=Math.pow(10,e),h=(c(a+"e+"+e)/g).toFixed(e),d>b-e&&(f=new RegExp("\\.?0{1,"+(d-(b-e))+"}$"),h=h.replace(f,"")),h}},b.options=h,b.formats=e,b.locales=f,b.locale=function(a){return a&&(h.currentLocale=a.toLowerCase()),h.currentLocale},b.localeData=function(a){if(!a)return f[h.currentLocale];if(a=a.toLowerCase(),!f[a])throw new Error("Unknown locale : "+a);return f[a]},b.reset=function(){for(var a in g)h[a]=g[a]},b.zeroFormat=function(a){h.zeroFormat="string"==typeof a?a:null},b.nullFormat=function(a){h.nullFormat="string"==typeof a?a:null},b.defaultFormat=function(a){h.defaultFormat="string"==typeof a?a:"0.0"},b.register=function(a,b,c){if(b=b.toLowerCase(),this[a+"s"][b])throw new TypeError(b+" "+a+" already registered.");return this[a+"s"][b]=c,c},b.validate=function(a,c){var d,e,f,g,h,i,j,k;if("string"!=typeof a&&(a+="",console.warn&&console.warn("Numeral.js: Value is not string. It has been co-erced to: ",a)),a=a.trim(),a.match(/^\d+$/))return!0;if(""===a)return!1;try{j=b.localeData(c)}catch(l){j=b.localeData(b.locale())}return f=j.currency.symbol,h=j.abbreviations,d=j.delimiters.decimal,e="."===j.delimiters.thousands?"\\.":j.delimiters.thousands,k=a.match(/^[^\d]+/),null!==k&&(a=a.substr(1),k[0]!==f)?!1:(k=a.match(/[^\d]+$/),null!==k&&(a=a.slice(0,-1),k[0]!==h.thousand&&k[0]!==h.million&&k[0]!==h.billion&&k[0]!==h.trillion)?!1:(i=new RegExp(e+"{2}"),a.match(/[^\d.,]/g)?!1:(g=a.split(d),g.length>2?!1:g.length<2?!!g[0].match(/^\d+.*\d$/)&&!g[0].match(i):1===g[0].length?!!g[0].match(/^\d+$/)&&!g[0].match(i)&&!!g[1].match(/^\d+$/):!!g[0].match(/^\d+.*\d$/)&&!g[0].match(i)&&!!g[1].match(/^\d+$/))))},b.fn=a.prototype={clone:function(){return b(this)},format:function(a,c){var d,f,g,i=this._value,j=a||h.defaultFormat;if(c=c||Math.round,0===i&&null!==h.zeroFormat)f=h.zeroFormat;else if(null===i&&null!==h.nullFormat)f=h.nullFormat;else{for(d in e)if(j.match(e[d].regexps.format)){g=e[d].format;break}g=g||b._.numberToFormat,f=g(i,j,c)}return f},value:function(){return this._value},input:function(){return this._input},set:function(a){return this._value=Number(a),this},add:function(a){function b(a,b,c,e){return a+Math.round(d*b)}var d=c.correctionFactor.call(null,this._value,a);return this._value=c.reduce([this._value,a],b,0)/d,this},subtract:function(a){function b(a,b,c,e){return a-Math.round(d*b)}var d=c.correctionFactor.call(null,this._value,a);return this._value=c.reduce([a],b,Math.round(this._value*d))/d,this},multiply:function(a){function b(a,b,d,e){var f=c.correctionFactor(a,b);return Math.round(a*f)*Math.round(b*f)/Math.round(f*f)}return this._value=c.reduce([this._value,a],b,1),this},divide:function(a){function b(a,b,d,e){var f=c.correctionFactor(a,b);return Math.round(a*f)/Math.round(b*f)}return this._value=c.reduce([this._value,a],b),this},difference:function(a){return Math.abs(b(this._value).subtract(a).value())}},b.register("locale","en",{delimiters:{thousands:",",decimal:"."},abbreviations:{thousand:"k",million:"m",billion:"b",trillion:"t"},ordinal:function(a){var b=a%10;return 1===~~(a%100/10)?"th":1===b?"st":2===b?"nd":3===b?"rd":"th"},currency:{symbol:"$"}}),function(){b.register("format","bps",{regexps:{format:/(BPS)/,unformat:/(BPS)/},format:function(a,c,d){var e,f=b._.includes(c," BPS")?" ":"";return a=1e4*a,c=c.replace(/\s?BPS/,""),e=b._.numberToFormat(a,c,d),b._.includes(e,")")?(e=e.split(""),e.splice(-1,0,f+"BPS"),e=e.join("")):e=e+f+"BPS",e},unformat:function(a){return+(1e-4*b._.stringToNumber(a)).toFixed(15)}})}(),function(){var a={base:1e3,suffixes:["B","KB","MB","GB","TB","PB","EB","ZB","YB"]},c={base:1024,suffixes:["B","KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"]},d=a.suffixes.concat(c.suffixes.filter(function(b){return a.suffixes.indexOf(b)<0})),e=d.join("|");e="("+e.replace("B","B(?!PS)")+")",b.register("format","bytes",{regexps:{format:/([0\s]i?b)/,unformat:new RegExp(e)},format:function(d,e,f){var g,h,i,j,k=b._.includes(e,"ib")?c:a,l=b._.includes(e," b")||b._.includes(e," ib")?" ":"";for(e=e.replace(/\s?i?b/,""),h=0;h<=k.suffixes.length;h++)if(i=Math.pow(k.base,h),j=Math.pow(k.base,h+1),null===d||0===d||d>=i&&j>d){l+=k.suffixes[h],i>0&&(d/=i);break}return g=b._.numberToFormat(d,e,f),g+l},unformat:function(d){var e,f,g=b._.stringToNumber(d);if(g){for(e=a.suffixes.length-1;e>=0;e--){if(b._.includes(d,a.suffixes[e])){f=Math.pow(a.base,e);break}if(b._.includes(d,c.suffixes[e])){f=Math.pow(c.base,e);break}}g*=f||1}return g}})}(),function(){b.register("format","currency",{regexps:{format:/(\$)/},format:function(a,c,d){var e,f,g,h=b.locales[b.options.currentLocale],i={before:c.match(/^([\+|\-|\(|\s|\$]*)/)[0],after:c.match(/([\+|\-|\)|\s|\$]*)$/)[0]};for(c=c.replace(/\s?\$\s?/,""),e=b._.numberToFormat(a,c,d),a>=0?(i.before=i.before.replace(/[\-\(]/,""),i.after=i.after.replace(/[\-\)]/,"")):0>a&&!b._.includes(i.before,"-")&&!b._.includes(i.before,"(")&&(i.before="-"+i.before),g=0;g<i.before.length;g++)switch(f=i.before[g]){case"$":e=b._.insert(e,h.currency.symbol,g);break;case" ":e=b._.insert(e," ",g+h.currency.symbol.length-1)}for(g=i.after.length-1;g>=0;g--)switch(f=i.after[g]){case"$":e=g===i.after.length-1?e+h.currency.symbol:b._.insert(e,h.currency.symbol,-(i.after.length-(1+g)));break;case" ":e=g===i.after.length-1?e+" ":b._.insert(e," ",-(i.after.length-(1+g)+h.currency.symbol.length-1))}return e}})}(),function(){b.register("format","exponential",{regexps:{format:/(e\+|e-)/,unformat:/(e\+|e-)/},format:function(a,c,d){var e,f="number"!=typeof a||b._.isNaN(a)?"0e+0":a.toExponential(),g=f.split("e");return c=c.replace(/e[\+|\-]{1}0/,""),e=b._.numberToFormat(Number(g[0]),c,d),e+"e"+g[1]},unformat:function(a){function c(a,c,d,e){var f=b._.correctionFactor(a,c),g=a*f*(c*f)/(f*f);return g}var d=b._.includes(a,"e+")?a.split("e+"):a.split("e-"),e=Number(d[0]),f=Number(d[1]);return f=b._.includes(a,"e-")?f*=-1:f,b._.reduce([e,Math.pow(10,f)],c,1)}})}(),function(){b.register("format","ordinal",{regexps:{format:/(o)/},format:function(a,c,d){var e,f=b.locales[b.options.currentLocale],g=b._.includes(c," o")?" ":"";return c=c.replace(/\s?o/,""),g+=f.ordinal(a),e=b._.numberToFormat(a,c,d),e+g}})}(),function(){b.register("format","percentage",{regexps:{format:/(%)/,unformat:/(%)/},format:function(a,c,d){var e,f=b._.includes(c," %")?" ":"";return b.options.scalePercentBy100&&(a=100*a),c=c.replace(/\s?\%/,""),e=b._.numberToFormat(a,c,d),b._.includes(e,")")?(e=e.split(""),e.splice(-1,0,f+"%"),e=e.join("")):e=e+f+"%",e},unformat:function(a){var c=b._.stringToNumber(a);return b.options.scalePercentBy100?.01*c:c}})}(),function(){b.register("format","time",{regexps:{format:/(:)/,unformat:/(:)/},format:function(a,b,c){var d=Math.floor(a/60/60),e=Math.floor((a-60*d*60)/60),f=Math.round(a-60*d*60-60*e);return d+":"+(10>e?"0"+e:e)+":"+(10>f?"0"+f:f)},unformat:function(a){var b=a.split(":"),c=0;return 3===b.length?(c+=60*Number(b[0])*60,c+=60*Number(b[1]),c+=Number(b[2])):2===b.length&&(c+=60*Number(b[0]),c+=Number(b[1])),Number(c)}})}(),b});;(function($){let event_types=["prebuild","postbuild","click","dblclick","mouseenter","mouseleave","mouseout","mousemove","mouseover","mousedown","mouseup","wheel"];let h={};$.extend({bindRows:function(table_selector,jsons,key,option=0){$(table_selector).find("tr:not(:first-child)").remove();let header=$("<tr></tr>");if(validArray(option.columns)){for(let m of option.columns){header.append("<th>"+m+"</th>");}}else{h=Object.assign({},jsons[0]);for(let m of Object.getOwnPropertyNames(h)){header.append("<th>"+m+"</th>");}}
if($(table_selector).find("tr:first-child").length===0){if(validArray(option.columns)){$(table_selector).append(header);}}
if(validArray(jsons)){let _counter=-1;if(!!option.start_index&&typeof parseInt(option.start_index)==="number"){_counter=parseInt(option.start_index);}
for(let json of jsons){let row=builtRow(json,key,option,table_selector);if(_counter>0){row.prepend("<td>"+_counter+"</td>");_counter++;}
row.on("mouseover",resetHighlight);$(table_selector).append(row);fitTable(table_selector);if(option.highlight_row!==undefined){if(row.data(key.toLowerCase())===option.highlight_row){row.siblings().removeClass("highlight");row.addClass("highlight");row[0].scrollIntoView({behavior:!option.scrollview.behavior?'auto':option.scrollview.behavior,block:!option.scrollview.block?'center':option.scrollview.block});}}}}},updateRow:function(table_selector,json,key,option=0){let $row=$();$row=builtRow(json,key,option);$(table_selector).append($row);fitTable(table_selector);let _key=option.highlight_row=json[key];$.each($(table_selector).find("tr:not(:first-child)"),function(i,tr){if($(tr).data(key.toLowerCase())==_key){tr.scrollIntoView({behavior:'auto',block:'center'});$(tr).replaceWith($row);if(!!option.start_index&&typeof parseInt(option.start_index)==="number"){let _counter=$(tr).prevUntil("tbody").length+parseInt(option.start_index)-1;$(tr).prepend("<td cell-index>"+_counter+"</td>");}}});}});$.fn.bindRows=function(jsons,key,option=0){$.bindRows(this,jsons,key,option);}
$.fn.updateRow=function(jsons,key,option=0){$.updateRow(this,jsons,key,option);}
function highlightRow(){}
function sortBy(array,key){return array.sort(function(a,b){return a[key]-b[key];});}
function groupBy(xs,key){return xs.reduce(function(rv,x){(rv[x[key]]=rv[x[key]]||[]).push(x);return rv;},{});};function resetHighlight(e){$(this).parent().children().removeClass("highlight");};function builtRow(json,key,option){let row=$("<tr></tr>");bindEvent(row,option);if(!!option["prebuild"]){onBuildRow(row,json,option,option["prebuild"]);}
$.each(json,function(c,value){var col=$("<td></td>");let col_name=c;let row_data=$("<tr></tr>");let hide_key=option.hide_key!==undefined&&option.hide_key;let scale_col="";if(validJSON(option.scalable)){if(typeof option.scalable.column=='string'){scale_col=option.scalable.column;}}
if(key!==undefined&&key==c){row_data=$("<tr data-"+key+"="+value+"></tr>");row=row_data;}
if(validJSON(option.scalable)&&col_name==scale_col){col=scalableColumn(value,option.scalable);}else{col=$("<td>"+value+"</td>");}
if(validArray(option.text_align)){for(let ta of option.text_align){$.each(ta,function(cn,p){if(col_name===cn){col=$("<td>"+value+"</td>");col.css("text-align",p);}});}}
if(col_name===key){col=$("<td>"+value+"</td>");if(hide_key){col=$("<td hidden>"+value+"</td>");}}
if(validArray(option.hidden_columns)){for(let hc of option.hidden_columns){if(hc===col_name){col=$("<td cell-"+col_name+" hidden>"+value+"</td>");}}}
if(validArray(option.html)){for(let value of option.html){if(value.column!==undefined&&value.column===col_name){injectHtml(col,value,col_name);}}}
col.attr("cell-"+col_name,"");row.append(col);});if(option.html!==undefined){for(let hc of option.html){if(hc.column===-1){let col=$("<td></td>");injectHtml(col,hc);row.append(col);}}}
bindEvent(row,option);if(!!option["postbuild"]){onBuildRow(row,json,option,option["postbuild"]);}
return row;};function bindEvent(row,option){if(validJSON(option)){$.each(option,function(key,value){for(let et of event_types){if(typeof value=='function'){if(key==et){row.on(key,value);}}}});}};function onBuildRow(row,data,setting,callback){return callback.call(row,data,setting);};function scalableColumn(value,scalable){let $col=$("<td></td>");$wrap_scale=$("<div class='wrap-scale'>"
+"<i class='scale-down'>-</i>"
+"<label data-scale='"+value+"' class='scale'>"+value+"</label>"
+"<i class='scale-up'>+</i>"
+"</div>");if(scalable.callback!==undefined){$wrap_scale.on(scalable.event,scalable.callback);}
$wrap_scale.appendTo($col);return $col;};function injectHtml($col,value){if(value.element!==undefined){let $_json=(value.listener===undefined)?$(value.element):$(value.element).on(value.listener.event,value.listener.callback);let $_arr=(value.listener===undefined)?$(value.element):$(value.element).on(value.listener[0],value.listener[1]);switch(value.insertion){case"prepend":$col.prepend(Array.isArray(value.listener)?$_arr:$_json);break;case"append":$col.append(Array.isArray(value.listener)?$_arr:$_json);break;case"replace":$col.html(Array.isArray(value.listener)?$_arr:$_json);break;default:$col.append(Array.isArray(value.listener)?$_arr:$_json);}}};function fitTable(table_selector){if($(table_selector).height()>$(table_selector).parent().height()){$(table_selector).parent().addClass("fit-scroll-y");}else{$(table_selector).parent().removeClass("fit-scroll-y");}};function validJSON(json){return json!==undefined&&json.constructor===Object&&Object.keys(json).length>0;};function validArray(array){return array!==undefined&&Array.isArray(array)&&array.length>0;};}(jQuery));class DialogBuilder{constructor(config){this._background=$("<div class='dialog-box-background'></div>");this._self=$("<div class='dialog-box'></div>");this._header=$("<div class='header'></div>");this._content=$("<div class='content'></div>");this._footer=$("<div class='footer'></div>");this._setting={self:this.self,class:"",container:{selector:"",attribute:"dialog-container"},insertion:"append",caption:"",content:"",content_type:"text",type:"",icon:"",position:"",button:{meta:this},animation:{startup:{complete:false,timing:"after",name:"slide-down",delay:0,duration:300,callback:function(e){}},shutdown:{complete:false,timing:"after",name:"slide-up",delay:0,duration:300,callback:function(e){},keycode:27,}}}
this.setting=config;}
set setting(config){if(!!config&&config.constructor===Object&&Object.keys(config).length>0){this._setting=$.extend(true,{},this._setting,config);}}
get setting(){return this._setting;}
get background(){return this._background;}
get self(){return this._self;}
get header(){return this._header;}
get content(){return this._content;}
get footer(){return this._footer;}
addOrigin(process,name){this.setting.animation[process].name=name;switch(name){case"slide-up":if(process==="startup"){this.self.addClass("origin-bottom");}
if(process==="shutdown"){this.self.addClass("origin-top");}
break;case"slide-down":if(process==="startup"){this.self.addClass("origin-top");}
if(process==="shutdown"){this.self.addClass("origin-bottom");}
break;case"slide-left":if(process==="startup"){this.self.addClass("origin-right");}
if(process==="shutdown"){this.self.addClass("origin-left");}
break;case"slide-right":if(process==="startup"){this.self.addClass("origin-left");}
if(process==="shutdown"){this.self.addClass("origin-right");}
break;case"fade":this.self.addClass("fade");break;}}
removeOrigin(process,name){this.setting.animation[process].name=name;switch(name){case"slide-up":this.self.removeClass("origin-bottom");break;case"slide-down":this.self.removeClass("origin-top");break;case"slide-left":this.self.removeClass("origin-right");break;case"slide-right":this.self.removeClass("origin-left");break;case"fade":this.self.removeClass("fade");break;}}
animate(process,delay,duration,name){this.setting.animation[process].delay=delay;this.setting.animation[process].duration=duration;this.setting.animation[process].name=name;let timespan=parseFloat(duration)/1000;setTimeout(()=>{switch(process){case"startup":this.self.addClass("startup").css("transition",timespan+"s");this.background.addClass("blur").css("transition",timespan+"s");break;case"shutdown":this.self.removeClass("startup").addClass("shutdown").css("transition",timespan+"s");this.background.removeClass("blur").css("transition",timespan+"s");break;}},parseFloat(this.setting.animation[process].delay));}
onEffect(process,timing,callback){this.setting.animation[process].timing=timing;this.setting.animation[process].callback=callback;}
startup(timing,callback){if(!!timing&&typeof timing==="string"){this.setting.animation.startup.timing=timing;this.setting.animation.startup.callback=callback;}
let $this=this,_startup=this.setting.animation.startup;switch(_startup.timing.toLowerCase()){case"before":$this.build($this.setting);_startup.callback(this,this.self);$this.setPosition($this.setting.position);$this.addOrigin("startup",$this.setting.animation.startup.name);$this.animate("startup",_startup.delay,_startup.duration,_startup.name);break;case"during":this.build(this.setting);this.setPosition(this.setting.position);this.addOrigin("startup",this.setting.animation.startup.name);this.animate("startup",_startup.delay,_startup.duration,_startup.name);setTimeout(function(){_startup.callback($this,$this.self);},(parseFloat(_startup.delay)+parseFloat(_startup.duration))/ 2);break;case"after":this.build(this.setting);this.setPosition(this.setting.position);this.addOrigin("startup",this.setting.animation.startup.name);this.animate("startup",_startup.delay,_startup.duration,_startup.name);setTimeout(function(){_startup.callback($this,$this.self);},parseFloat(_startup.delay)+parseFloat(_startup.duration));break;}
this.onEffect("startup",_startup.timing,_startup.callback);this.setting.animation.startup.complete=true;}
shutdown(timing,callback){if(this.setting.animation.startup.complete){if(!!timing&&typeof timing==="string"){this.setting.animation.shutdown.timing=timing;this.setting.animation.shutdown.callback=callback;}
let _shutdown=this.setting.animation.shutdown;switch(_shutdown.timing.toLowerCase()){case"before":_shutdown.callback(this,this.self);this.removeOrigin("startup",this.setting.animation.startup.name);this.addOrigin("shutdown",this.setting.animation.shutdown.name);this.animate("shutdown",_shutdown.delay,_shutdown.duration,_shutdown.name);break;case"during":this.removeOrigin("startup",this.setting.animation.startup.name);this.addOrigin("shutdown",this.setting.animation.shutdown.name);this.animate("shutdown",_shutdown.delay,_shutdown.duration,_shutdown.name);_shutdown.callback(this,this.self);break;case"after":this.removeOrigin("startup",this.setting.animation.startup.name);this.addOrigin("shutdown",this.setting.animation.shutdown.name);this.animate("shutdown",_shutdown.delay,_shutdown.duration,_shutdown.name);setTimeout(()=>{_shutdown.callback(this,this.self);},parseFloat(_shutdown.delay)+parseFloat(_shutdown.duration));break;}
setTimeout(()=>{this.onEffect("shutdown",_shutdown.timing,_shutdown.callback);this.destroy();},parseFloat(this.setting.animation.shutdown.delay)
+parseFloat(this.setting.animation.shutdown.duration));this.setting.animation.shutdown.complete=true;}}
setPosition(value){if(value!==undefined){this.setting.position=value;switch(this.setting.position){case"top-left":this.background.addClass("top-left");break;case"top-center":this.background.addClass("top-center");break;case"top-right":this.background.addClass("top-right");break;case"center-left":this.background.addClass("center-left");break;case"center":this.background.addClass("center");break;case"center-right":this.background.addClass("center-right");break;case"bottom-left":this.background.addClass("bottom-left");break;case"bottom-center":this.background.addClass("bottom-center");break;case"bottom-right":this.background.addClass("bottom-right");break;}}}
build(config){}
render(){let container=this.setting.container.selector;if(!!this.setting.container.attribute){container=$("["+this.setting.container.attribute+"]");}
if(!!container){let $this=this,insertion=this.setting.insertion;document.addEventListener("keyup",function(e){let _keycode=$this.setting.animation.shutdown.keycode;if(typeof $this.setting.animation.shutdown.keycode==="string"){_keycode=$this.setting.animation.shutdown.keycode.toLowerCase();}
if(e.which===_keycode){$this.shutdown();}});switch(insertion.toLowerCase()){case"replace":container.html(this.background);break;case"prepend":container.prepend(this.background);break;case"append":container.append(this.background);break;}
container.css({"position":"fixed","top":"0","z-index":"2147483647"});}}
destroy(){let container=this.setting.container.selector;if(!!this.setting.container.attribute){container=$("["+this.setting.container.attribute+"]");}
if(this instanceof DialogBuilder){delete this;this.background.remove();container.children().remove();}}
highestZIndex(tag_name){let tag="*";let highest=0;if(!!tag_name){tag=tag_name;}
$(tag).each(function(){let zindex=$(this).css("z-index");if((zindex>highest)&&(zindex!='auto')){highest=zindex;}});return highest;}}
class DialogBox extends DialogBuilder{constructor(config){super(config);this.setting={type:"ok",icon:"info",close_button:true,position:"top-center",button:{yes:{meta:this,text:"Yes",callback:function(e){},keycode:13},no:{meta:this,text:"No",callback:function(e){},keycode:undefined},ok:{meta:this,text:"Ok",callback:function(e){},keycode:13},cancel:{meta:this,text:"Cancel",callback:function(e){},keycode:27}}}
this.setting=config;this.startup();}
confirm(callback){this.setting.button.ok.callback=callback;this.setting.button.yes.callback=callback;}
reject(callback){this.setting.button.no.callback=callback;this.setting.button.cancel.callback=callback;}
get caption(){let $caption=$("<div class='caption'></div>");if(this.setting.caption!==undefined){$caption.append(this.setting.caption);}
return $caption;}
get closeButton(){let $this=this;let $wrap_icon=$("<div class='wrap-icon'></div>");let $close_button=$();if(this.setting.close_button===true){$close_button=$("<i class='icon icon-close'></i>");}else{if(typeof this.setting.close_button==="string"){$close_button=$("<i class='"+this.setting.close_button+"'></i>");}}
return $wrap_icon.append($close_button.on("click",function(e){$this.shutdown();}));}
get icon(){let $wrap_icon=$("<div class='wrap-icon'></div>");let $icon=$("<div class='icon'></div>");if(this.setting.icon!==undefined){switch(this.setting.icon){case"info":$icon.addClass("info");break;case"warning":$icon.addClass("warning");break;case"danger":$icon.addClass("danger");break;default:if(!!this.setting.icon&&this.setting.icon.constructor===Object&&Object.keys(this.setting.icon).length>0){let icon=this.setting.icon;let $i_icon=$("<i></i>");if(icon.class!==undefined){$i_icon.addClass(icon.class);}
if(icon.color!==undefined){$i_icon.css("color",icon.color);}
if(icon.background_color!==undefined){$icon.css("background",icon.background_color);}
$icon.append($i_icon);}
if(typeof this.setting.icon==="string"){$icon.append("<i class='"+this.setting.icon+"'></i>");if(!!this.setting.icon&&(/<[a-z/][\s\S]*>/i).test(this.setting.icon)){$icon.append(this.setting.icon);}}
if(this.setting.icon==="none"||this.setting.icon==null){$icon=$();}}}
return $wrap_icon.append($icon);}
get button(){let $button_wrap=$("<div class='wrap-button'></div>");if(this.setting.button==="none"){$button_wrap.addClass("free-space");}
if(!!this.setting.button&&this.setting.button.constructor===Object&&Object.keys(this.setting.button).length>0){let type=this.setting.type.toLowerCase();let button=this.setting.button;let $ok=$("<div class='button'>"+button.ok.text+"</div>");let $yes=$("<div class='button'>"+button.yes.text+"</div>");let $no=$("<div class='button'>"+button.no.text+"</div>");let $cancel=$("<div class='button'>"+button.cancel.text+"</div>");switch(type){case"ok":if(typeof button.ok.callback==="function"){$ok.on("click",function(e){button.ok.callback(e);if(typeof button.meta.setting.content==="string"){button.meta.shutdown();}});}
$button_wrap.append($ok).addClass("right");break;case"yes-no":case"yes/no":if(typeof button.yes.callback==="function"){$yes.on("click",function(e){button.yes.callback(e);});}
if(typeof button.no.callback==="function"){$no.on("click",function(e){button.no.callback(e);if(typeof button.meta.setting.content==="string"){button.meta.shutdown();}});}
$button_wrap.append($yes).append($no).addClass("right");break;case"ok-cancel":case"ok/cancel":if(typeof button.ok.callback==="function"){$ok.on("click",function(e){button.ok.callback(e);});}
if(typeof button.cancel.callback==="function"){$cancel.on("click",function(e){button.cancel.callback(e);if(typeof button.meta.setting.content==="string"){button.meta.shutdown();}});}
$button_wrap.append($ok).append($cancel).addClass("right");break;case"yes-no-cancel":case"yes/no/cancel":if(typeof button.yes.callback==="function"){$yes.on("click",function(e){button.yes.callback(e);});}
if(typeof button.no.callback==="function"){$no.on("click",function(e){button.no.callback(e);});}
if(typeof button.cancel.callback==="function"){$cancel.on("click",function(e){button.cancel.callback(e);if(typeof button.meta.setting.content==="string"){button.meta.shutdown();}});}
$button_wrap.append($yes).append($no).append($cancel).addClass("right");break;default:if(this.setting.type==="none"){return $button_wrap.addClass("free-space");}}}
return $button_wrap;}
build(config){this.destroy();this.setting=config;this.header.children().remove();this.header.append(this.icon).append(this.caption).append(this.closeButton);if(this.setting.content!==undefined){this.content.html("<span>"+this.setting.content+"</span>");if(!!this.setting.content&&this.setting.content.constructor===Object&&Object.keys(this.setting.content).length>0){if(this.setting.content.selector.includes("#")||this.setting.content.selector.includes(".")){let $cloned=$(this.setting.content.selector).clone(true);this.content.html($cloned).addClass("outer-content");if(this.setting.content.class!==undefined){this.content.removeClass("outer-content").addClass(this.setting.content.class);}}}}
this.footer.html(this.button);this.self.append(this.header).append(this.content).append(this.footer);this.background.append(this.self);this.render();}}
class DialogCalculator extends DialogBuilder{constructor(config){super(config);this._left=0;this._right=0;this._result=0;this.setting={position:"top-center",output:this.result,button:{accept:{meta:this,text:"Accept",callback:function(e){}}},animation:{shutdown:{name:"slide-up"}}}
Number.prototype.precise=function(max_precision){return(this.toString().length>max_precision)?this.toPrecision(max_precision):this;}
Math.negative=function(value){return parseFloat(value)<0;}
Math.negate=function(value){return parseFloat(value)*(-1);}
this.setting=config;this.startup();}
set result(value){this._result=value;}
get result(){return this._result;}
set left(value){this._left=parseFloat(value);}
get left(){return this._left;}
set right(value){this._right=parseFloat(value);}
get right(){return this._right;}
multiply(){this._result=this._left*this._right;return this._result;}
divide(){if(this._right!==0){this._result=this._left / this._right;}else{if(Math.negative(this._left)){this._result=Number.NEGATIVE_INFINITY;}else{this._result=Number.POSITIVE_INFINITY;}}
return this._result;}
add(){this._result=this._left+this._right;return this._result;}
substract(){this._result=this._left-this._right;return this._result;}
accept(callback){this.setting.button.accept.callback=callback;}
build(setting){let $this=this;this.setting=setting;this.self.addClass("calculator standard");let $content=$("<div class='navigator reserve'></div>"
+"<div class='navigator output'>0</div>"
+"<div class='keypad'>"
+"<div data-key='ce' class='key control'>CE</div>"
+"<div data-key='c' class='key control'>C</div>"
+"<div data-key='backspace' class='key control'><i class='backspace'>×</i></div>"
+"<div data-key='÷' class='key operator'>÷</div>"
+"<div data-key='7' class='key operant'>7</div>"
+"<div data-key='8' class='key operant'>8</div>"
+"<div data-key='9' class='key operant'>9</div>"
+"<div data-key='×' class='key operator'>×</div>"
+"<div data-key='4' class='key operant'>4</div>"
+"<div data-key='5' class='key operant'>5</div>"
+"<div data-key='6' class='key operant'>6</div>"
+"<div data-key='-' class='key operator'>-</div>"
+"<div data-key='1' class='key operant'>1</div>"
+"<div data-key='2' class='key operant'>2</div>"
+"<div data-key='3' class='key operant'>3</div>"
+"<div data-key='+' class='key operator'>+</div>"
+"<div data-key='±' class='key control'>±</div>"
+"<div data-key='0' class='key operant'>0</div>"
+"<div data-key='.' class='key operant'>.</div>"
+"<div data-key='=' class='key r-operator'>=</div>"
+"</div>");this.self.html($content).append($("<div class='navigator accept-result'>Accept</div>").on("click",function(e){$this.setting.button.accept.callback(this,e);}));this.calculate(this.self);this.background.html(this.self).on("click",function(e){if($(e.target).is(this)){$this.shutdown();}});this.render();};calculate($calc){const self=this;const $operant=$calc.find('.keypad .key.operant');const $operator=$operant.siblings(".operator");const $r_operator=$operant.siblings(".r-operator");const $output=$operant.parent().siblings(".output");const $reserve=$output.siblings(".reserve");const $control=$operant.siblings(".control");let output=0;let reserve="";let sign="";let ready=false;$operant.click(function(e){if(ready){output=$(this).data('key').toString();}else{if($output.text().length<13){output+=$(this).data('key').toString();}}
output=self.validNumber(output);$output.text(output);ready=false;});$operator.click(function(e){resultClicked(e);sign=$(this).data("key").toString();calc.left=parseFloat(output);reserve=calc.left.precise(9)+" "+sign;$(".reserve").text(reserve);$(".output").text(output);ready=true;});$r_operator.click(resultClicked);function resultClicked(e){if(sign===""){return;}
calc.right=parseFloat(output);reserve=calc.left.precise(6)+" "+sign+" "+calc.right.precise(6);if(Math.negative(calc.right)){reserve=calc.left.precise(6)+" "+sign+" ( "+calc.right.precise(6)+" )";}
output="";switch(sign){case"×":calc.multiply();break;case"÷":calc.divide();break;case"+":calc.add();break;case"-":calc.substract();break;}
output=calc.result.precise(9);$reserve.text(reserve);$output.text(output);ready=true;}
$control.click(function(e){output=output.toString();switch($(this).data("key")){case'±':output=Math.negate(output).toString();break;case'backspace':if(output.includes("Infinity")){output=0;}else{output=output.substring(0,output.length-1);if(output.length<2&&output.includes("-")){output=0;}}
break;case'c':calc.left=0;calc.right=0;calc.result=0;output=0;sign="";reserve="";break;case'ce':output=0;break;}
if(output.length===0){output=0;}
$reserve.text(reserve);$output.text(output);});}
validNumber(value){if(!!value&&typeof value==="number"){value=value.toString();}
if(value=="-00"){value="-0";}
if(value==""||value=="-"||value=="00"){value="0";}
if(value=="."){value="0.";}
if(!(/^[-]?\d+[.]?\d*$/).test(value)){if(value=="-"){value="-"+value;}
value=value.toString().substring(0,value.length-1);}else{if(!value.includes(".")&&value!="-0"){value=parseFloat(value);}}
return value;}}
class AjaxLoader{constructor(image,config){this._self=$("<div class='ajax-loader'></div>");this._content=$("<div class='content'></div>");this._setting={container:"body",image:image,}
if(config!==undefined){this.setting=config;}
this.refresh();}
set setting(config){if(_$_.isValidJSON(config)){this._setting=$.extend(true,{},this._setting,config);}}
get setting(){return this._setting;}
get self(){return this._self;}
get content(){return this._content;}
refresh(){setTimeout(()=>{this.build(this.setting);},0);}
async build(config){this.setting=config;let $image=$("<img src='"+this.setting.image+"'/>");this.content.html($image);this.self.append(this.content);$(this.setting.container).append(this.self);}
async show(){this.self.removeClass("hide");}
async hide(){this.self.addClass("hide");}
async close(){if(this instanceof AjaxLoader){setTimeout(()=>{delete this;this.self.remove();},0);}}}class _$_{static isJSON(value){return value!==undefined&&value.constructor===Object;}
static isValidJSON(json){return json!==undefined&&json.constructor===Object&&Object.keys(json).length>0;}
static isArray(value){return value!==undefined&&Array.isArray(value);}
static isValidArray(value){return value!==undefined&&Array.isArray(value)&&value.length>0;}
static isHTML(value){return value!==undefined&&(/<[a-z/][\s\S]*>/i).test(value);}
static validNumber(value){if(value=="00"){value="0";}
if(value==="."){value="0.";}
if(!value.includes(".")){value=parseFloat(value);}
if(!(/^[-]?\d+[.]?\d*$/).test(value)){value=value.toString().substring(0,value.length-1);}
return value;}
static isUniform(a,b,equal){let identical=false;if(_$_.isValidJSON(a)&&_$_.isValidJSON(b)){$.each(a,function(ak,av){$.each(b,function(bk,bv){identical=ak===bk;});});}
if(a!==undefined&&!_$_.isValidJSON(a)){if(b!==undefined&&!_$_.isValidJSON(b)){return a===b;}}
return identical;}
static targetBound(target,event_type){let bound=false
if(target!==undefined){$.each($._data(target,"events"),function(k,v){if(k===event_type){bound=true;}});}
return bound;}
static highestZindex(highest,tag_name){let tag="*";if(tag_name!==undefined){tag=tag_name;}
$(tag).each(function(){let zindex=$(this).css("z-index");if((zindex>highest)&&(zindex!='auto')){highest=zindex;}});return highest;}}
class Dropbox{static get target(){return"html, .dropbox-btn, .i-close";}
constructor(container,config=0){this._target="html, #demo-order-list .dropbox-btn, #demo-order-list .i-close";this._self=$();this._setting={container:container,direction:"down",insertion:"replace",on_target:"mousedown",type:"list",has_crumb:true,trigger:{icon:"fas fa-list-alt"},content:{add_option:{class:"fas fa-plus",listener:[]},scroll:"vertical",data:[],option:{has_title:false,icon:"fas fa-receipt",listener:[]}}}
this.setting=config;this.settingUpdated();Array.prototype.where=function(condition){return $.grep(this,function(json,i){return condition(json,i);});};Array.prototype.first=function(condition){return $.grep(this,function(json,i){return condition(json,i);})[0];};Array.prototype.remove=function(key){if(_$_.validArray(key)){for(let k of key){this.remove(k);}}else{let item={};item=this.first(function(item){return item.key===key;});if(this.indexOf(item)!==-1){this.splice(this.indexOf(item),1);}}}}
get target(){return this._target;}
get self(){return this._self;}
get setting(){return this._setting;}
set setting(config){if(_$_.isValidJSON(config)){this._setting=$.extend(true,{},this._setting,config);}}
async settingUpdated(){await Promise.resolve(setTimeout(()=>{this.refresh();},0));}
refresh(){this.init(this.setting);}
moveScrollY(selector,position){switch(position){case"top":$(selector).scrollTop(0);break;case"bottom":$(selector).scrollTop($(selector)[0].scrollHeight);break;default:$(selector).scrollTop($(selector)[0].scrollHeight);}}
onTarget(event_type){let target=this.target;let $self=this.self;$(target).on(event_type,function(e){e.stopPropagation();if($(this).is($self.find(".dropbox-btn"))){$(this).toggleClass("show");$(this).siblings(".wrap-dropbox-content").toggleClass("show");}
if($(this).is($self.find(".i-close"))){$self.find(".dropbox-btn").removeClass("show");$self.find(".wrap-dropbox-content").removeClass("show");}
if($(this).is($self.parents())&&!$(e.target).is($self.find("*"))){$self.find(".dropbox-btn").removeClass("show");$self.find(".wrap-dropbox-content").removeClass("show");}});}
static async onTarget(event_type){let selector=Dropbox.target;$(selector).on(event_type,function(e){e.stopPropagation();if($(this).is($(".dropbox-btn"))){$(this).toggleClass("show");$(this).siblings(".wrap-dropbox-content").toggleClass("show");}
if($(this).is($(".i-close"))){$(this).parent().parent().siblings(".dropbox-btn").removeClass("show");$(this).parent().parent(".wrap-dropbox-content").removeClass("show");}
if($(this).is($("html"))&&!$(e.target).is($(".dropbox *"))){$(".dropbox .dropbox-btn").removeClass("show");$(".dropbox .wrap-dropbox-content").removeClass("show");}});}
async buildTrigger($dropbox){let $dropbox_btn=$("<div class='dropbox-btn'></div>");let $badge=$("<div class='badge'></div>");let $icon=$("<i class='icon'></i>");let $img_circle=$("<img class='img-circle' src='/images/user.png'/>");if($dropbox.hasClass("list")){if(_$_.isValidJSON(this.setting)){if(_$_.isHTML(this.setting.trigger.icon)){$icon.replaceWith(this.setting.trigger.icon);}else{if(typeof this.setting.trigger.icon==="string"){$icon.addClass(this.setting.trigger.icon);}}
if(this.setting.trigger.badge!==undefined){$badge.append(this.setting.trigger.badge);}}
$dropbox_btn.append($icon).append($badge);}
if($dropbox.hasClass("profile")){if(_$_.isValidJSON(this.setting)){if(_$_.isHTML(this.setting.trigger.icon)){$img_circle.replaceWith(this.setting.trigger.icon);}else{$img_circle.prop("src",this.setting.trigger.icon);}}
$dropbox_btn.append($img_circle);}
$dropbox.append($dropbox_btn);}
async buildContent($dropbox){let $wrap_dropbox_content=$("<div class='wrap-dropbox-content'></div>");$("<div class='dropbox-navigator'>"
+"<div class='i-close far fa-window-close'></div>"
+"</div>").appendTo($wrap_dropbox_content);let $dropbox_content=$("<div class='dropbox-content'></div>");let add_opt=this.setting.content.add_option;if($dropbox.hasClass("list")){if(_$_.isValidJSON(add_opt)){let $add_option=$("<i class='add-option'></i>");if(add_opt.class!==undefined){$add_option.addClass(add_opt.class);}
if(_$_.validArray(add_opt.listener)){$add_option.on(add_opt.listener[0],add_opt.listener[1]);}
if(_$_.isValidJSON(add_opt.listener)){$add_option.on(add_opt.listener.event,add_opt.listener.callback);}
$dropbox_content.append($add_option);}}
let $wrap_option=$("<div class='wrap-option'></div>");switch(this.setting.content.scroll){case"vertical":$wrap_option.addClass("scroll-y");break;case"none":$wrap_option.removeClass("scroll-y");break;default:$wrap_option.addClass("scroll-y");}
let data=this.setting.content.data;let opt=this.setting.content.option;if(_$_.validArray(data)){data.forEach(function(d){let $option=$("<a class='option' href='#' data-key='"+d.key+"'>"+" "+d.value+"</a>");let $icon=$("<i class='"+opt.icon+"'></i>");if(d.icon!==undefined){if(_$_.isHTML(d.icon)){$icon=d.icon;}else{$icon.addClass(d.icon);}}
$option.prepend($icon);if(d.url!==undefined){$option.prop("href",d.url);}
if(opt.has_title){$option.prop("title",d.value);}
if(d.title!==undefined){$option.prop("title",d.title);}
if(_$_.validArray(opt.listener)){$option.on(opt.listener[0],opt.listener[1]);}
if(_$_.isValidJSON(opt.listener)){$option.on(opt.listener.event,opt.listener.callback);}
$wrap_option.append($option);});}
$dropbox_content.append($wrap_option);$wrap_dropbox_content.append($dropbox_content);$dropbox.append($wrap_dropbox_content);}
async render(){let $dropbox=$("<div class='dropbox crumb'></div>");if(_$_.isValidJSON(this.setting)){if(this.setting.type!==undefined){$dropbox.addClass(this.setting.type);}
if(this.setting.direction!==undefined){$dropbox.addClass(this.setting.direction);}
if(this.setting.has_crumb!==undefined&&!this.setting.has_crumb){$dropbox.removeClass("crumb");}}
await this.buildTrigger($dropbox);await this.buildContent($dropbox);this._self=$dropbox;}
async init(config){if(!_$_.isValidJSON(config)){return;};this.setting=config;if(this.setting.container!==undefined){await this.render();switch(this.setting.insertion){case"prepend":$(this.setting.container).prepend(this.self);break;case"append":$(this.setting.container).append(this.self);break;case"replace":$(this.setting.container).html(this.self);break;default:$(this.setting.container).prepend(this.self);}
this.onTarget(this.setting.on_target);}}}
$(function(){$("html, .dropbox-btn, .i-close").on("mousedown",function(e){if($(this).is($(".dropbox-btn"))){$(this).toggleClass("show");$(this).siblings(".wrap-dropbox-content").toggleClass("show");}
if($(this).is($(".i-close"))){$(this).parent().parent().siblings(".dropbox-btn").removeClass("show");$(this).parent().parent(".wrap-dropbox-content").removeClass("show");}
if($(this).is($("html"))&&!$(e.target).is($(".dropbox *"))){$(".dropbox .dropbox-btn").removeClass("show");$(".dropbox .wrap-dropbox-content").removeClass("show");}});})
$(function(){let $toggle_listview=$("#toggle-listview");$toggle_listview.click(function(e){$(this).children(".far").toggleClass("fa-window-minimize fa-window-maximize");$("#panel-group-items .right-panel").toggleClass("hide");});});$(function(){let wrap_input=$(".group-search-boxes .wrap-search-box .wrap-input");wrap_input.siblings(".btn-search").click(function(e){$(this).siblings(".wrap-input").addClass("show");$(this).parent().parent().find(".btn-search").hide();setTimeout(()=>{wrap_input.find("input").focus().val("");},250);if($(this).parent().parent().parent().hasClass("nav-toolbar")){$(this).parent().parent().siblings().addClass("hide");}});wrap_input.find("#i-close").click(function(e){e.preventDefault();$(this).parent().removeClass("show");$(this).parent().parent().parent().find(".btn-search").show();$(this).parent().parent().parent().siblings().removeClass("hide");});});class Slideshow{constructor(config){this._self=$("<div class='slideshow'></div>");this._content=$("<div class='content'></div>");this._setting={container:"",image_list:[]}}
set setting(config){this._setting=$.extend(true,{},this._setting,config);}
get setting(){return this._setting;}
get self(){return this._self;}
get content(){return this._content;}
async build(){this.setting.container.html(this.self);}}﻿function addNewItemAddon(scale,item_master){let item={};item.Line_ID=item_master.ID;item.OrderDetailID=0;item.Code=item_master.Code;item.ItemID=item_master.ItemID;item.KhmerName=item_master.KhmerName
item.EnglishName=item_master.EnglishName;item.UnitPrice=parseFloat(item_master.UnitPrice);item.Cost=item_master.Cost;item.Qty=1;item.UoM=item_master.UoM;item.PrintQty=1;item.DiscountRate=parseFloat(item_master.DiscountRate);item.TypeDis=item_master.TypeDis;item.ItemStatus='new';item.Currency=item_master.Currency;if(item_master.ItemType!='Service'){if(item.TypeDis==='Percent'){item.Total=((item.Qty*item.UnitPrice)*(1-(item.DiscountRate / 100)));item.DiscountValue=((item.Qty*item.UnitPrice)*item.DiscountRate)/ 100;}
else{item.Total=((item.Qty*item.UnitPrice)-item.DiscountRate);item.DiscountValue=item.DiscountRate;}}
let lineId;if(db.from('tb_order_detail')==0){lineId=parentLevel+'2'+'1';}else{let addOn=db.from('tb_order_detail').where(w=>{return w.ParentLevel==parentLevel});if(!!addOn){lineId=parentLevel+'2'+(parseInt(addOn.length)+1);}else{lineId=parentLevel+'2'+'1';}}
item.Total_Sys=item.Total*local_currency.ratein;item.UomID=item_master.UomID;item_master.PrintQty=item.PrintQty;item.ItemPrintTo=item_master.PrintTo;item.Comment='';item.ItemType=item_master.ItemType;item.Description=item_master.Description;item.ParentLevel=parentLevel;item.Line_ID=parseInt(lineId);item_master.PrintQty=0;scale.parent().remove();insertAddonIndex(item)
summaryTotal(item.Line_ID,'Y');};function addOnItem(parent_row){let line_id=parseInt($(parent_row).data('line_id'));parentLevel=line_id.toString();const $wrap_grid=$("#group-item-gridview .wrap-grid");$(".all-step").parent().find(":not(:first-child)").remove();let group_items=db.from("tb_group1").where(w=>{return w.Name.includes('*')});groupItemFiltered($wrap_grid,group_items,1,0,0,0);};function insertAddonIndex(item){let p_index,add_ons=new Array();let parents=db.from('tb_order_detail');if(parentLevel!=""&&db.table("tb_order_detail").size>0){add_ons=db.from('tb_order_detail').where(w=>{return w.ParentLevel==parentLevel;});let last_ch=add_ons[add_ons.length-1];if(last_ch!=undefined){p_index=parents.findIndex(w=>w.Line_ID==last_ch.Line_ID)+1;}
if(add_ons.length==1){p_index=parents.findIndex(w=>w.ParentLevel==parentLevel)+1;}
else{let last_ch=add_ons[add_ons.length-1];if(last_ch!=undefined){p_index=parents.findIndex(w=>w.Line_ID==last_ch.Line_ID)+1;}}
parents.splice(p_index,0,item);db.table('tb_order_detail').clear();db.insert('tb_order_detail',parents,'Line_ID');}else{db.insert('tb_order_detail',item,'Line_ID');}};﻿$("#bill").click(function(){let user_privillege=db.table("tb_user_privillege").get('P007');if(user_privillege.Used===false){let dlg=new DialogBox({position:"top-center",content:{selector:"#admin-authorization",class:"login"},icon:"fas fa-lock",button:{ok:{text:"Login",callback:function(e){let access=accessSecurity(this.meta.content,'P007');if(access===false){this.meta.content.find('.error-security-login').text('You can not access ...!');return;}
else{this.meta.content.find('.security-username').focus();this.meta.setting.icon="fas fa-lock fa-spin";this.meta.content.find('.error-security-login').text('');this.text="Logging...";this.meta.build(this.setting);setTimeout(()=>{this.meta.build(this.setting);this.meta.setting.icon="fas fa-unlock-alt";setTimeout(()=>{confirmBill();},100);},500);}}}}});}
else{confirmBill();}});function confirmBill(){if(db.from("tb_check_open_shift")===0){let msg=new DialogBox({caption:"Information",content:"Please open shift before bill...!",position:"top-center",type:"ok",icon:"info"});msg.setting.button.ok.callback=function(e){this.meta.shutdown();}
return;}
if(db.from("tb_order_detail")!==0){if(order_master.OrderID===0){sendData(0,'Bill');}
else{sendData(order_master.OrderID,'Bill');}}
else{let msg=new DialogBox({caption:"Information",content:"Data was empty...!",position:"top-center",type:"ok",icon:"info"});msg.setting.button.ok.callback=function(e){this.meta.shutdown();};}};﻿$("#dbl-cancel-receipt").click(function(e){confirmCancelReceipt();});function confirmCancelReceipt(){let user_privillege=db.table("tb_user_privillege").get('P020');if(user_privillege.Used===false){let dlg=new DialogBox({position:"top-center",content:{selector:"#admin-authorization",class:"login"},icon:"fas fa-lock",button:{ok:{text:"Login",callback:function(e){let access=accessSecurity(this.meta.content,'P020');if(access===false){this.meta.content.find('.error-security-login').text('You can not access ...!');return;}
else{this.meta.content.find('.security-username').focus();this.meta.setting.icon="fas fa-lock fa-spin";this.text="Logging...";this.meta.content.find('.error-security-login').text('');this.meta.build(this.setting);setTimeout(()=>{this.meta.build(this.setting);this.meta.setting.icon="fas fa-unlock-alt";setTimeout(()=>{initFormSaleReceipt();},100);},500);}}}}});}
else{initFormSaleReceipt();}};function initFormSaleReceipt(){let reprint=new DialogBox({position:"top-center",caption:"Cancel Receipt",content:{selector:"#cancel-receipt-content"},button:{ok:{text:"Close",callback:function(e){this.meta.shutdown();}}},icon:"fas fa-print"});reprint.startup("before",function(dialog){let receipts=$.ajax({url:'/POS/GetReceiptCancel',async:false,type:'GET',data:{branchid:order_info.branchid,date_from:null,date_to:null}}).responseJSON;initDataCancelReceipt(receipts);});};function initDataCancelReceipt(receipts){db.map("tb_cancel_receipt").clear();$.each(receipts,function(i,receipt){let rec={};rec.orderid=receipt.ReceiptID;rec.receipt_no=receipt.ReceiptNo;rec.cashier=receipt.UserAccount.Employee.Name;rec.dateout=receipt.DateOut.slice(0,10);rec.timeout=receipt.TimeOut;if(local_currency.symbol==='KHR'||local_currency.symbol==='៛'){rec.amount=numeral(receipt.GrandTotal).format('0,0');}
else{rec.amount=receipt.GrandTotal.toFixed(2);}
rec.currency=receipt.Currency.Description;if(receipt.GrandTotal<0){rec.action='<div class="btn action disabled" style="margin-right:10px; color:red;"><i class="fas fa-trash-restore"></i></div>'}
else{rec.action='<div class="btn action" style="margin-right:10px;"><i class="fas fa-trash-restore"></i></div>'}
db.insert("tb_cancel_receipt",rec,"orderid");});$.bindRows(".cancel-receipt-listview",db.from("tb_cancel_receipt"),"orderid",{text_align:[{"cashier":"left"}],show_key:false,hidden_columns:["orderid"]});$(".action",".cancel-receipt-listview").click(function(){rowClickedCancel(this);});};function rowClickedCancel(row){let orderid=parseInt($(row).parent().parent().data("orderid"));$(row).parent().parent().remove();$.ajax({url:"/POS/CancelReceipt",async:false,type:"POST",data:{orderid:orderid},success:function(){}});};let date_to_cancel=null;let date_from_cancel=null;$('.cancel-date-from').change(function(){date_from_cancel=$(this).val();});$('.cancel-date-to').change(function(){date_to_cancel=$(this).val();let receipts=$.ajax({url:'/POS/GetReceiptCancel',async:false,type:'GET',data:{branchid:order_info.branchid,date_from:date_from_cancel,date_to:date_to_cancel},success:function(){}}).responseJSON;initDataCancelReceipt(receipts);});$('#txt-item-cancel-search').keyup(function(){var value=$(this).val().toLowerCase();$(".cancel-receipt-listview tr:not(first-child)").filter(function(){$(this).toggle($(this).text().toLowerCase().indexOf(value)>-1)});});﻿$("#dbl-clear-order").click(function(e){clearOrder();});function clearOrder(){parentLevel="";newdefaultOrder();defaultGroup1();order_master.OrderID=0;db.map("tb_order_detail").clear();db.map("tb_show_item_barcode").clear();let customer=db.get('tb_customer').get(order_master.CustomerID);$('.customer-name').text(customer.Name);if(db.from('tb_show_item')!=0){db.from("tb_show_item").where(function(json){json.PrintQty=0;});}
$.bindRows("#item-listview",db.from("tb_order_detail"),'Line_ID',{});summaryTotal(0,'Y');};﻿$("#dbl-combine-receipt").click(function(e){comfirmCombine();});function comfirmCombine(){let user_privillege=db.table("tb_user_privillege").get('P002');if(user_privillege.Used===false){let dlg=new DialogBox({position:"top-center",content:{selector:"#admin-authorization",class:"login"},icon:"fas fa-lock",button:{ok:{text:"Login",callback:function(e){let access=accessSecurity(this.meta.content,'P002');if(access===false){this.meta.content.find('.error-security-login').text('You can not access ...!');return;}
else{this.meta.content.find('.security-username').focus();this.meta.setting.icon="fas fa-lock fa-spin";this.text="Logging...";this.meta.content.find('.error-security-login').text('');this.meta.build(this.setting);setTimeout(()=>{this.meta.build(this.setting);this.meta.setting.icon="fas fa-unlock-alt";setTimeout(()=>{initFormCombine();},100);},500);}}}}});}
else{initFormCombine();}};function initFormCombine(){if($("#item-listview").find('tr:not(:first-child)').length!==0){if(order_master.OrderID!==0){let out="";let orders=$.ajax({url:'/POS/GetReceiptCombine',type:'GET',async:false,data:{orderid:order_master.OrderID}}).responseJSON;$.each(orders,function(i,order){let table_name=db.table("tb_table").get(order.TableID);out+="<label class='rc-container mx1'>"
+"<input data-id="+order.OrderID+" name='receipt' type='checkbox'>"
+"<span class='checkmark'></span>"
+table_name.Name+" #"+order.OrderNo
+"</label>"
+"<hr/>";});$('.combine-receipt-list').html(out);let msg=new DialogBox({caption:"Combine Receipt ( "+order_master.OrderNo+" )",content:{selector:"#combine-receipt"},position:"top-center",type:"ok-cancel"});msg.setting.animation.shutdown.animation_type="slide-up";msg.setting.button.ok.text="Combine";msg.confirm(combineReceipt);msg.reject(function(e){this.meta.shutdown();})}
else{let msg=new DialogBox({caption:"Information",content:"Please send data before combine...!",position:"top-center",type:"ok",icon:"info"});msg.setting.button.ok.callback=function(e){this.meta.shutdown();};}}
else{let msg=new DialogBox({caption:"Information",content:"Data was empty...!",position:"top-center",type:"ok",icon:"info"});msg.setting.button.ok.callback=function(e){this.meta.shutdown();};}};$('input[name=search-combine-receipt]').on('keyup',function(){var query=$(this).val().toLowerCase();$('.combine-receipt-list .rc-container').each(function(){var $this=$(this);if($this.text().toLowerCase().indexOf(query)===-1)
$this.closest('.rc-container').hide();else $this.closest('.rc-container').show();});});function combineReceipt(){let loader=null;loader=new AjaxLoader("/pos/icons/ajax-loader/loading.gif");db.map("tb_combine_receipt").clear();let receipts=$("input[name='receipt']");$.each(receipts,function(i,receipt){if($(receipt).prop("checked")){rec={};rec.OrderID=$(receipt).data("id");db.insert("tb_combine_receipt",rec,'OrderID');}});let CombineReceipt={TableId:table_info.id,OrderID:order_master.OrderID,Receipts:db.from("tb_combine_receipt")};this.meta.shutdown();$.ajax({url:'/POS/CombineReceipt',type:'POST',data:{combineReceipt:CombineReceipt},success:function(response){console.log('combined...');loader.close();clickOnOrderNo(table_info.id,order_master.OrderID);}});};﻿$("#goto-create-customer").click(function(){confirmCreateCustomer();});$('.change-customer').click(function(){initFormListCustomer();});$("#goto-list-customer").click(function(){initFormListCustomer();});function initFormListCustomer(){let list_customer=new DialogBox({icon:"far fa-list-alt",close_button:true,content:{selector:"#list-customer-content",},caption:"List Customer",position:"top-center",type:"ok",button:{ok:{text:"Cancel",callback:function(e){this.meta.shutdown();}}}});initCustomer(list_customer);};function initCustomer(list_customer){$.bindRows(".list-customer-listview",db.from('tb_customer'),"ID",{text_align:[{"Name":"left"}],html:[{column:-1,insertion:"replace",element:'<div class=btn><i class="fas fa-arrow-circle-right"></i></div>',listener:["click",function(e){rowChooseCustomer(this);list_customer.shutdown();}]}],hidden_columns:["ID","Type","PriceListID","PriceList","Delete"]});};$("#search-customer").keyup(function(){let _input=this;let search=$(_input).val().toString().toLowerCase();$(".list-customer-listview tr:not(:first-child").filter(function(){$(this).toggle($(this).text().toLowerCase().indexOf(search)>-1);});});function rowChooseCustomer(row){let customer_id=parseInt($(row).parent().parent().data('id'));let customer=db.get('tb_customer').get(customer_id);order_master.CustomerID=customer_id;$('.change-customer').text(customer.Name);};function confirmCreateCustomer(){let user_privillege=db.table("tb_user_privillege").get('P018');if(user_privillege.Used===false){let dlg=new DialogBox({position:"top-center",content:{selector:"#admin-authorization",class:"login"},icon:"fas fa-lock",button:{ok:{text:"Login",callback:function(e){let access=accessSecurity(this.meta.content,'P018');if(access===false){this.meta.content.find('.error-security-login').text('You can not access ...!');return;}
else{this.meta.content.find('.security-username').focus();this.meta.setting.icon="fas fa-lock fa-spin";this.text="Logging...";this.meta.content.find('.error-security-login').text('');this.meta.build(this.setting);setTimeout(()=>{this.meta.build(this.setting);this.meta.setting.icon="fas fa-unlock-alt";setTimeout(()=>{this.meta.shutdown();initFromCustomer();},100);},500);}}}}});}
else{initFromCustomer();}};function initFromCustomer(){let create_customer=new DialogBox({icon:"far fa-list-alt",close_button:true,content:{selector:"#create-customer-content",},caption:"Create Customer",position:"top-center",type:"ok-cancel",button:{ok:{text:"Add",callback:function(e){let content=this.meta.content;if(content.find('.customer-code').val()==null||content.find('.customer-code').val()==''){$('.customer-code-validate').text('Error: Code required !');content.find('.customer-code').focus();}
else if(content.find('.customer-name').val()==null||content.find('.customer-name').val()==''){$('.customer-code-validate').text('Error: Name required !');content.find('.customer-name').focus();}
else if(content.find('.customer-address').val()==null||content.find('.customer-address').val()==''){$('.customer-code-validate').text('Error: Address required !');content.find('.customer-address').focus();}
else if(content.find('.customer-phone').val()==null||content.find('.customer-phone').val()==''){$('.customer-code-validate').text('Error: Phone required !');content.find('.customer-phone').focus();}
else{createCustomer(content);}}},cancel:{callback:function(e){this.meta.shutdown();}}}});create_customer.startup("after",function(dialog){let content=dialog.content;content.find(".customer-code").focus();});};$(".customer-code").on('keyup',function(){let _input=this;let code=$(_input).val().toString().toLowerCase();let customer=db.from("tb_customer").where(w=>{return w.Code.toLowerCase()==code;});if(customer.length!=0){$('.customer-code-validate').text('Error: This code have exist...!');}
else{$('.customer-code-validate').text('');}});$(".customer-code").on('focusout',function(){$('.customer-code-validate').text('');});function createCustomer(content){let loader=null;loader=new AjaxLoader("/pos/icons/ajax-loader/loading.gif");BusinessPartner={ID:0,Code:content.find('.customer-code').val(),Name:content.find('.customer-name').val(),Type:"Customer",PriceListID:setting.PriceListID,Phone:content.find('.customer-phone').val(),Email:content.find('.customer-email').val(),Address:content.find('.customer-address').val(),Delete:false};$.ajax({url:'/POS/CreateCustomer',type:'POST',data:{business:BusinessPartner},dataType:'JSON',success:function(response){if(response.ID<0){$('.customer-code-validate').text('Error: This code have exist...!');loader.hide();}
else{$('.customer-code-validate').text('Successfully...').css("color","green");db.insert('tb_customer',response,"ID");order_master.CustomerID=parseInt(response.ID);$('.change-customer').text(response.Name);loader.hide();clearCreateCustomer(content);}},error:function(){console.log('customer not complete');}});};function clearCreateCustomer(content){content.find('.customer-code').focus();content.find('.customer-code').val('');content.find('.customer-name').val('');Phone:content.find('.customer-phone').val('');Address:content.find('.customer-address').val('');setTimeout(function(){$('.customer-code-validate').text('').css("color","red");},1000);};﻿$("#dbl-discount-item").click(function(e){confirmDiscountItem();});function confirmDiscountItem(){let user_privillege=db.table("tb_user_privillege").get('P019');if(user_privillege.Used===false){let dlg=new DialogBox({position:"top-center",content:{selector:"#admin-authorization",class:"login"},icon:"fas fa-lock",button:{ok:{text:"Login",callback:function(e){let access=accessSecurity(this.meta.content,'P019');if(access===false){this.meta.content.find('.error-security-login').text('You can not access ...!');return;}
else{this.meta.content.find('.security-username').focus();this.meta.setting.icon="fas fa-lock fa-spin";this.text="Logging...";this.meta.content.find('.error-security-login').text('');this.meta.build(this.setting);setTimeout(()=>{this.meta.build(this.setting);this.meta.setting.icon="fas fa-unlock-alt";setTimeout(()=>{initFormDiscountItem();},100);},500);}}}}});}
else{initFormDiscountItem();}};function initFormDiscountItem(){if($("#item-listview").find('tr:not(:first-child)').length!==0){db.map("tb_discount-item").clear();let msg=new DialogBox({caption:"Discount Item",content:{selector:"#discount-item"},position:"top-center",type:"ok-cancel"});msg.setting.animation.shutdown.animation_type="slide-up";msg.setting.button.ok.text="Apply";msg.confirm(function(){discountItem(this.meta.content);this.meta.shutdown();});msg.reject(function(e){this.meta.shutdown();})
$.each(db.from("tb_order_detail").where(w=>{return w.Qty>0;}),function(i,item){let item_add={};item_add.line_id=item.Line_ID;item_add.code=item.Code;item_add.name=item.KhmerName;item_add.uom=item.UoM;if(item.DiscountRate==0){item_add.discountRate="<input width='100' name=discount-item value='"+''+"' type='text'>";}
else{item_add.discountRate="<input name=discount-item value='"+item.DiscountRate+"' type='text'>";}
db.insert("tb_discount-item",item_add,"line_id");});bindRowDiscountItem();}
else{let msg=new DialogBox({caption:"Information",content:"Data was empty...!",position:"top-center",type:"ok",icon:"info"});msg.setting.button.ok.callback=function(e){this.meta.shutdown();};}};let typedis='Percent';$('.discount-item-type').change(function(){typedis=$(this).val();});function discountItem(content){let items_discount=content.find("input[name='discount-item']");$.each(items_discount,function(i,item){let discount=parseFloat($(item).val());if(isNaN(discount)){}
else{let line_id=$(item).parent().parent().data("line_id");let items_ordered=db.get("tb_order_detail").get(line_id);items_ordered.DiscountRate=discount;items_ordered.TypeDis=typedis;if(items_ordered.TypeDis==='Percent'){items_ordered.Total=((items_ordered.Qty*items_ordered.UnitPrice)*(1-(items_ordered.DiscountRate / 100)));items_ordered.DiscountValue=((items_ordered.Qty*items_ordered.UnitPrice)*items_ordered.DiscountRate)/ 100;}
else{items_ordered.Total=((items_ordered.Qty*items_ordered.UnitPrice)-items_ordered.DiscountRate);items_ordered.DiscountValue=items_ordered.DiscountRate;}
items_ordered.Total_Sys=items_ordered.Total*local_currency.ratein;db.insert("tb_order_detail",items_ordered,"Line_ID");}});summaryTotal(0,'Y');};function bindRowDiscountItem(){let discount_item=db.from("tb_discount-item");$.bindRows("#discount-item-listview",discount_item,"line_id",{text_align:[{"name":"left"}],hidden_columns:["line_id"]});};﻿$("#btn-discount").click(function(e){confirmDiscount();});function confirmDiscount(){let user_privillege=db.table("tb_user_privillege").get('P006');if(user_privillege.Used===false){let dlg=new DialogBox({position:"top-center",content:{selector:"#admin-authorization",class:"login"},icon:"fas fa-lock",button:{ok:{text:"Login",callback:function(e){let access=accessSecurity(this.meta.content,'P006');if(access===false){this.meta.content.find('.error-security-login').text('You can not access ...!');return;}
else{this.meta.content.find('.security-username').focus();this.meta.setting.icon="fas fa-lock fa-spin";this.text="Logging...";this.meta.content.find('.error-security-login').text('');this.meta.build(this.setting);setTimeout(()=>{this.meta.build(this.setting);this.meta.setting.icon="fas fa-unlock-alt";setTimeout(()=>{initFormDiscountMember();},100);},500);}}}}});}
else{initFormDiscountMember();}};let discountRate=0;let typeDis='Percent';function rowClicked(){let ref_no=$(this).data("ref_no");let detail_info=db.table("tb_members_card").get(ref_no.toString());discountRate=detail_info.discount;typeDis=detail_info.typedis;$(".member-id").text(detail_info.ref_no);$(".member-name").text(detail_info.name);$(".member-card-type").text(detail_info.card_type);if(detail_info.typedis==='Percent')
$(".member-discount").text(detail_info.discount+"%");else
$(".member-discount").text(detail_info.discount+" "+local_currency.name);$(".member-expire").text(detail_info.expire);$(".member-descr").text(detail_info.desc);};function initFormDiscountMember(){if($("#item-listview").find('tr:not(:first-child)').length!==0){let members=$.ajax({url:'/POS/GetMemberCard',type:'GET',async:false,success:function(){},error:function(e){}}).responseJSON;$.each(members,function(i,mem){let member={};member.ref_no=mem.Ref_No;member.name=mem.Name;member.card_type=mem.CardType.Name;member.desc=mem.Description;member.discount=mem.CardType.Discount;member.typedis=mem.CardType.TypeDis;member.expire=mem.ExpireDate.slice(0,10);;db.insert("tb_members_card",member,"ref_no");});$.bindRows(".membercard-discount-listview",db.from("tb_members_card"),"ref_no",{click:rowClicked,text_align:[{"name":"left"}],hidden_columns:["discount","desc","expire","typedis"]});let msg=new DialogBox({caption:"Discount Member Card",content:{selector:"#membercard-discount"},position:"top-center",type:"ok-cancel",button:{ok:{text:"Apply"}},animation:{shutdown:{animation_type:"slide-up"}}});msg.confirm(discountApply);msg.reject(function(e){this.meta.shutdown();});}
else{let msg=new DialogBox({caption:"Empty",content:"Can not discount...!",position:"top-center",type:"ok",icon:"info"});msg.setting.button.ok.callback=function(e){this.meta.shutdown();};}};function discountApply(){order_master.DiscountRate=discountRate;order_master.TypeDis=typeDis;summaryTotal(0,'Y');this.meta.shutdown();};$('input[name=search-member]').on('keyup',function(){var query=($(this).val()).toLowerCase();if(db.from("tb_members_card")!==0){let member_filtered=db.from("tb_members_card").where(w=>{return w.name.toLowerCase().includes(query)||w.ref_no===query;});$.bindRows(".membercard-discount-listview",member_filtered,"ref_no",{click:rowClicked,text_align:[{"name":"left"}],hidden_columns:["discount","desc","expire","typedis"]});}});﻿$('#btn-dis-total').click(function(){confirmDiscountTotal();});function confirmDiscountTotal(){let user_privillege=db.table("tb_user_privillege").get('P022');if(user_privillege.Used===false){let dlg=new DialogBox({position:"top-center",content:{selector:"#admin-authorization",class:"login"},icon:"fas fa-lock",button:{ok:{text:"Login",callback:function(e){let access=accessSecurity(this.meta.content,'P006');if(access===false){this.meta.content.find('.error-security-login').text('You can not access ...!');return;}
else{this.meta.content.find('.security-username').focus();this.meta.setting.icon="fas fa-lock fa-spin";this.text="Logging...";this.meta.content.find('.error-security-login').text('');this.meta.build(this.setting);setTimeout(()=>{this.meta.build(this.setting);this.meta.setting.icon="fas fa-unlock-alt";setTimeout(()=>{initFormDiscountTotal();},100);},500);}}}}});}
else{initFormDiscountTotal();}};function initFormDiscountTotal(){$('.discount-total-erorr').text('');let dlg=new DialogBox({position:"top-center",content:{selector:"#content-dis-total",class:'login'},icon:"fas fa-percent fa-fw",button:{ok:{text:"OK",callback:function(e){var discount=parseFloat(dlg.content.find('.discount-total').val());var type=dlg.content.find('.dis-total-type').val();if(isNaN(discount)){dlg.content.find('.discount-total').val('');dlg.content.find('.discount-total').focus();$('.discount-total-erorr').text("Please input discount...!");}
else{if(type=='Percent'){if(discount<=100){order_master.DiscountRate=discount;order_master.TypeDis=type;summaryTotal(0,'Y');this.meta.shutdown();}
else{dlg.content.find('.discount-total').val('');dlg.content.find('.discount-total').focus();$('.discount-total-erorr').text("Discount can not bigger than 100%");}}
else{if(discount<=order_master.GrandTotal){order_master.DiscountRate=discount;order_master.TypeDis=type;summaryTotal(0,'Y');this.meta.shutdown();}
else{dlg.content.find('.discount-total').val('');dlg.content.find('.discount-total').focus();$('.discount-total-erorr').text("Discount can not bigger than pay");}}}}}}});dlg.startup("after",function(dialog){dialog.content.find('.discount-total').val('');dialog.content.find('.discount-total').focus();});};﻿$("#dbl-edit-price").click(function(e){confirmEditPrice();});function confirmEditPrice(){let user_privillege=db.table("tb_user_privillege").get('P004');if(user_privillege.Used===false){let dlg=new DialogBox({position:"top-center",content:{selector:"#admin-authorization",class:"login"},icon:"fas fa-lock",button:{ok:{text:"Login",callback:function(e){let access=accessSecurity(this.meta.content,'P004');if(access===false){this.meta.content.find('.error-security-login').text('You can not access ...!');return;}
else{this.meta.content.find('.security-username').focus();this.meta.setting.icon="fas fa-lock fa-spin";this.text="Logging...";this.meta.content.find('.error-security-login').text('');this.meta.build(this.setting);setTimeout(()=>{this.meta.build(this.setting);this.meta.setting.icon="fas fa-unlock-alt";setTimeout(()=>{initFormEditPrice();},100);},500);}}}}});}
else{initFormEditPrice();}};function initFormEditPrice(){if($("#item-listview").find('tr:not(:first-child)').length!==0){db.map("tb_edit_item_price").clear();let msg=new DialogBox({caption:"Edit Item Price",content:{selector:"#edit-item-price"},position:"top-center",type:"ok-cancel"});msg.setting.animation.shutdown.animation_type="slide-up";msg.setting.button.ok.text="Edit";msg.confirm(editItemPrice);msg.reject(function(e){this.meta.shutdown();})
$.each(db.from("tb_order_detail").where(w=>{return w.Qty>0;}),function(i,item){let item_add={};item_add.line_id=item.Line_ID;item_add.code=item.Code;item_add.name=item.KhmerName;item_add.uom=item.UoM;item_add.price=item.UnitPrice;item_add.symbol='->';db.insert("tb_edit_item_price",item_add,"line_id");});bindRowEditPrice();}
else{let msg=new DialogBox({caption:"Information",content:"Data was empty...!",position:"top-center",type:"ok",icon:"info"});msg.setting.button.ok.callback=function(e){this.meta.shutdown();};}};function editItemPrice(){let items_edit=$("input[name='edit-price']");let items_name=$("input[name='name']",this.meta.content.find("table"));$.each(items_edit,function(i,item){let new_price=parseFloat($(item).val());if(isNaN(new_price)){}
else{let line_id=$(item).parent().parent().data("line_id");let items_ordered=db.get("tb_order_detail").get(line_id);items_ordered.UnitPrice=new_price;if(items_ordered.TypeDis==='Percent'){items_ordered.Total=((items_ordered.Qty*items_ordered.UnitPrice)*(1-(items_ordered.DiscountRate / 100)));items_ordered.DiscountValue=((items_ordered.Qty*items_ordered.UnitPrice)*items_ordered.DiscountRate)/ 100;}
else{items_ordered.Total=((items_ordered.Qty*items_ordered.UnitPrice)-items_ordered.DiscountRate);items_ordered.DiscountValue=items_ordered.DiscountRate;}
items_ordered.Total_Sys=items_ordered.Total*local_currency.ratein;db.insert("tb_order_detail",items_ordered,"Line_ID");}});$.each(items_name,function(i,item){let new_name=$(item).val();let line_id=$(item).parent().parent().data("line_id");let items_ordered=db.get("tb_order_detail").get(line_id);items_ordered.KhmerName=new_name;db.insert("tb_order_detail",items_ordered,"Line_ID");});summaryTotal(0,'Y');this.meta.shutdown();};function bindRowEditPrice(){let edit_item_price=db.from("tb_edit_item_price");$.bindRows("#edit-item-price-listview",edit_item_price,"line_id",{text_align:[{"name":"left"}],prebuild:function(data){data.name='<input name=name value="'+data.name+'" type="text" />';},html:[{column:-1,insertion:"replace",element:' <input name=edit-price type="text" />',listener:["keyup",function(e){rowEditItemPrice(this);}]}],hidden_columns:["line_id","new_price"]});};function rowEditItemPrice(){};﻿const $all_step=$(".group-steps .all-step");$all_step.on('click',function(e){const $wrap_grid=$("#group-item-gridview .wrap-grid");$(this).parent().find(":not(:first-child)").remove();let group_items=db.from("tb_group1");groupItemFiltered($wrap_grid,group_items,1,0,0,0);$(this).siblings().removeClass("active");$(this).addClass("active");});function clickOnstep(e){const $wrap_grid=$("#group-item-gridview .wrap-grid");let level=parseInt($(this).data("group"));let group_id=$(this).data("id");let group1_id=parseInt($(this).data("group1"));let group2_id=parseInt($(this).data("group2"));let group3_id=parseInt($(this).data("group3"));let length=$(this).parent().children().length
let nth_child=$(this).index();for(let i=length;i>0;i--){if(i>nth_child+1){$(".group-steps").find(":nth-child("+i+")").remove();}}
$(this).siblings().removeClass("active");$(this).addClass("active");let group_items;if(level!==3){group_items=$.ajax({url:"/POS/GetGroupItem",async:false,type:"GET",data:{group1_id:group1_id,group2_id:group2_id,level:level},dataType:"JSON"}).responseJSON;}
level=level+1;if(level===4){let multi_items=db.from("tb_item_master").where(w=>{return w.ItemID===group_id;});singleItem($("#group-item-gridview .wrap-grid"),multi_items);}
else if(Array.isArray(group_items)&&group_items.length>=0){groupItemFiltered($wrap_grid,group_items,level,group1_id,group2_id,group3_id);}
else{$wrap_grid.children().remove();}};function defaultGroup1(){const $wrap_grid=$("#group-item-gridview .wrap-grid");$(".all-step").parent().find(":not(:first-child)").remove();let group_items=db.from("tb_group1");groupItemFiltered($wrap_grid,group_items,1,0,0,0);};﻿function accessSecurity(content,code){let check=false;let username=content.find('.security-username').val();let pass=content.find('.security-password').val();let access=$.ajax({url:'/POS/GetUserAccessAdmin',async:false,type:'GET',dataType:'JSON',data:{username:username,pass:pass,code:code}}).responseJSON;if(access!==undefined){return access.Used;}
else{if(username==""){content.find('.security-username').focus();}
else if(pass==""){content.find('.security-password').focus();}
return check;}};﻿function GetUoMs(){$.ajax({url:"/POS/GetUoMs",async:false,success:function(uoms){db.insert("tb_uom",uoms,"ID");}});};GetUoMs();function clickOnOrderNo(tableid,orderid){clearOrder();newdefaultOrder();$.ajax({url:"/POS/GetOrder",type:"POST",dataType:"JSON",data:{tableid:tableid,orderid:orderid,userid:order_master.UserOrderID},success:function(response){let orders=response[0];if(orders!==undefined){order_master={OrderID:orders.OrderID,OrderNo:orders.OrderNo,TableID:orders.TableID,ReceiptNo:orders.ReceiptNo,QueueNo:orders.QueueNo,DateIn:orders.DateIn,DateOut:orders.DateOut,TimeIn:orders.TimeIn,TimeOut:orders.TimeOut,WaiterID:orders.WaiterID,UserOrderID:orders.UserOrderID,UserDiscountID:orders.UserDiscountID,CustomerID:orders.CustomerID,CustomerCount:orders.CustomerCount,PriceListID:orders.PriceListID,LocalCurrencyID:orders.LocalCurrencyID,SysCurrencyID:orders.SysCurrencyID,ExchangeRate:orders.ExchangeRate,WarehouseID:orders.WarehouseID,BranchID:orders.BranchID,CompanyID:orders.CompanyID,Sub_Total:orders.Sub_Total,DiscountRate:orders.DiscountRate,DiscountValue:orders.DiscountValue,TypeDis:orders.TypeDis,TaxRate:orders.TaxRate,TaxValue:orders.TaxValue,GrandTotal:orders.GrandTotal,GrandTotal_Sys:orders.GrandTotal_Sys,Tip:orders.Tip,Received:orders.Received,Change:orders.Change,PaymentMeansID:orders.PaymentMeansID,CheckBill:orders.CheckBill};if(orders.OrderDetail.length==0){$(".Table").text(table_info.name);$("#send").text("Send");clearOrder();newdefaultOrder();return;}
let item_masters=[];$.each(orders.OrderDetail,function(i,detail){item={};item.Line_ID=detail.Line_ID;item.OrderDetailID=detail.OrderDetailID;item.Code=detail.Code;item.ItemID=detail.ItemID;item.KhmerName=detail.KhmerName;item.EnglishName=detail.EnglishName;item.UnitPrice=parseFloat(detail.UnitPrice);item.Cost=detail.Cost;item.Qty=detail.Qty;item.UoM=db.table("tb_uom").get(detail.UomID).Name;item.PrintQty=0;item.DiscountRate=parseFloat(detail.DiscountRate);item.TypeDis=detail.TypeDis;item.ItemStatus='old';item.Currency=detail.Currency;item.Total=detail.Total;item.DiscountValue=detail.DiscountValue;item.Total_Sys=detail.Total_Sys;item.UomID=detail.UomID;item.ItemPrintTo=detail.ItemPrintTo;item.Comment=detail.Comment;item.ItemType=detail.ItemType;item.Description=detail.Description;item.ParentLevel=detail.ParentLevel;let item_master=db.from("tb_item_master").first(function(json){return json.ID==parseInt(detail.Line_ID);});if(item_master!=undefined){item_masters.push(item_master);item_master.Qty=detail.Qty;item_master.KhmerName=detail.KhmerName;item_master.EnglishName=detail.KhmerName;item_master.PrintQty=0;db.insert('tb_show_item',item_master,'ID');}
db.insert("tb_order_detail",item,"Line_ID");});singleItem($("#group-item-gridview .wrap-grid"),item_masters);summaryTotal(0,'Y');$('#send').text('Save');$(".Table").text(table_info.name+"  #"+order_master.OrderNo);}
else{$(".Table").text(table_info.name);$("#send").text("Send");newdefaultOrder();}
let customer=db.get('tb_customer').get(order_master.CustomerID);$('.customer-name').text(customer.Name);}});};﻿let setting=$.ajax({url:"/POS/GetSetting",async:false,type:"GET",dataType:"JSON",}).responseJSON[0];let vat_include={};vat_include.name;vat_include.rate=0;vat_include.value=0;$.ajax({url:"/POS/GetVat",async:false,type:"GET",dataType:"JSON",success:function(response){if(response.length>0){vat_include.name=response[0].Name;vat_include.rate=response[0].Rate;}}});let local_currency={};local_currency.id;local_currency.symbol;local_currency.ratein;local_currency.rateout;$.ajax({url:"/POS/PriceListCurrecny",async:false,type:"GET",dataType:"JSON",data:{pricelistID:setting.PriceListID},success:function(response){$(".local-symbol").text(response.Currency.Description);local_currency.id=response.Currency.ID;local_currency.symbol=response.Currency.Description;local_currency.ratein=response.Rate;local_currency.rateout=response.RateOut;}});let local_rate=$.ajax({url:"/POS/GetLocalRate",async:false,type:"GET",dataType:"JSON",data:{localID:setting.LocalCurrencyID}}).responseJSON;newdefaultOrder();function newdefaultOrder(){return order_master={OrderID:0,OrderNo:'N/A',TableID:1,ReceiptNo:'N/A',QueueNo:"1",DateIn:date.getDate(),DateOut:date.getDate(),TimeIn:date.toLocaleTimeString(),TimeOut:date.toLocaleTimeString(),WaiterID:1,UserOrderID:order_info.user,UserDiscountID:order_info.user,CustomerID:setting.CustomerID,CustomerCount:1,PriceListID:setting.PriceListID,LocalCurrencyID:setting.LocalCurrencyID,SysCurrencyID:setting.SysCurrencyID,ExchangeRate:setting.RateIn,WarehouseID:setting.WarehouseID,BranchID:order_info.branchid,CompanyID:setting.CompanyID,Sub_Total:0,DiscountRate:0,DiscountValue:0,TypeDis:'Percent',TaxRate:vat_include.rate,TaxValue:vat_include.value,GrandTotal:0,GrandTotal_Sys:0,Tip:0,Received:0,Change:0,PaymentMeansID:setting.PaymentMeansID,CheckBill:'N',PLCurrencyID:local_currency.id,PLRate:local_currency.ratein,LocalSetRate:local_rate.SetRate,};};let displayCurrency=$.ajax({url:"/POS/GetDisplayCurrency",async:false,type:"GET",dataType:"JSON"}).responseJSON;fx.base=displayCurrency[0].BaseCurr;fx.rates={};$.each(displayCurrency,function(i,curr){if(curr.AltCurr!==fx.base){db.insert('tb_display_curr',curr,'ID');fx.rates[curr.AltCurr]=curr.Rate;}
let dis_curr="<option value="+curr.AltCurr+">"+curr.AltCurr+"</option>";$('.receipt-other-curr').append(dis_curr);});let dis_curr=db.from('tb_display_curr');let user_infor=$.ajax({url:'/POS/GetUserInfo',async:false,type:'GET',data:{userid:order_info.user},success:function(){}}).responseJSON;db.insert("tb_user_info",user_infor,'ID');OpenShift();function OpenShift(){let user_open_shift=$.ajax({url:'/POS/CheckOpenShift',async:false,type:'GET',data:{userid:order_info.user},success:function(){}}).responseJSON;db.insert("tb_check_open_shift",user_open_shift,'UserID');};let exchange_rate=$.ajax({url:'/POS/GetExchangeRate',async:false,type:'GET',success:function(){}}).responseJSON;db.insert("tb_exchange_rate",exchange_rate,'CurrencyID');$.each(exchange_rate,function(i,curr){let out="<option value="+curr.Currency.ID+">"+curr.Currency.Description+"</option>";$('#other-currency-list').append(out);$('#other-currency-list').val(setting.SysCurrencyID);});$.ajax({url:"/POS/GetGroupUomDefined",async:false,type:"GET",dataType:"JSON",success:function(response){if(response.length>0){db.insert("tb_group_uom_defined",response,"ID");}}});let table_info={};table_info.id=1;table_info.name='N/A';table_status='A';table_info.time="00:00:00";$.ajax({url:"/POS/GetGroupItem",type:"GET",dataType:"JSON",data:{group_id:0,level:0},success:function(group1){db.insert("tb_group1",group1,"ItemG1ID");}});let item_masters=$.ajax({url:"/POS/GetItemMasterData",async:false,type:"GET",dataType:"JSON",data:{PriceListID:setting.PriceListID},}).responseJSON;db.addTable("tb_item_master",item_masters,"ID");$.ajax({url:'/POS/GetPriceList',async:false,type:'GET',dataType:'JSON',success:function(pricelist){$.each(pricelist,function(i,pr){$('.price-list-id').append("<option value="+pr.ID+">"+pr.Name+"</option>");});}});$.ajax({url:'/POS/GetCustomer',async:false,type:'GET',dataType:'JSON',success:function(customer){db.insert("tb_customer",customer,"ID");$.each(customer,function(i,cus){$('.customer-id').append("<option value="+cus.ID+">"+cus.Name+"</option>");$('.price-list-id').val(cus.PriceListID);});}});let customer=db.get('tb_customer').get(order_master.CustomerID);$('.customer-name').text(customer.Name);$.ajax({url:'/POS/GetPaymentMeans',async:false,type:'GET',dataType:'JSON',success:function(paymentmeans){$.each(paymentmeans,function(i,pay){$('.payment-means-id').append("<option value="+pay.ID+">"+pay.Type+"</option>");$('.payment-means-id-choosed').append("<option value="+pay.ID+">"+pay.Type+"</option>");})}});$.ajax({url:'/POS/GetWarehouse',async:false,type:'GET',dataType:'JSON',data:{branchid:order_info.branchid},success:function(warehouse){$.each(warehouse,function(i,wh){$('.warehouse-id').append("<option value="+wh.ID+">"+wh.Name+"</option>");})}});$.ajax({url:'/POS/GetPrinterName',async:false,type:'GET',dataType:'JSON',success:function(printer){$.each(printer,function(i,print){$('.printer-id').append("<option value="+print.Name+">"+print.Name+"</option>");$('.add-new-item-printto').append("<option value="+print.Name+">"+print.Name+"</option>");});}});$.ajax({url:'/POS/GetUserPriviliges',async:false,type:'GET',dataType:'JSON',data:{userid:order_info.user},success:function(user){db.insert("tb_user_privillege",user,'Code');}});getCurrentDate();function getCurrentDate(){setInterval(function(){$(".datetime").html(padLeft(new Date().getDate(),2)+"-"+padLeft((new Date().getMonth()+1),2)+"-"+new Date().getFullYear()+" "+new Date().toLocaleTimeString());},1000);};function padLeft(data,size,paddingChar){return(new Array(size+1).join(paddingChar||'0')+String(data)).slice(-size);};﻿$("#add-new-order").click(function(e){clearOrder();newdefaultOrder();$(".Table").text(table_info.name);$("#send").text("Send");});function gridClicked(e){let group_id=$(this).children().data("id");let level=parseInt($(this).children().data("group"));let group1_id=parseInt($(this).children().data("group1"));let group2_id=parseInt($(this).children().data("group2"));let group3_id=parseInt($(this).children().data("group3"));let step_name=$(this).children().data("step");$(".group-steps").append($('<div class="wrap-step step" data-id="'+group_id+'" data-group1="'+group1_id+'" data-group2="'+group2_id+'" data-group3="'+group3_id+'" data-group="'+level+'" >'+step_name+'</div>').on('click',clickOnstep));let group_items;if(level<=3){group_items=$.ajax({url:"/POS/GetGroupItem",async:false,type:"GET",data:{group1_id:group1_id,group2_id:group2_id,level:level},dataType:"JSON"}).responseJSON;}
level=level+1;if(level==5){if(db.table("tb_item_master").size>0){let item_filtered=db.from("tb_item_master").where(w=>{return w.ItemID===group_id;});singleItem($("#group-item-gridview .wrap-grid"),item_filtered);}}
else if(Array.isArray(group_items)&&group_items.length>=0){groupItemFiltered($(this).parent(),group_items,level,group1_id,group2_id,group3_id);}
else{$(this).parent().children().remove();}};let $grid=$("#group-item-gridview .wrap-grid .grid");$grid.click(gridClicked);function groupItemFiltered($wrap_grid,group_items,level,group1_id,group2_id,group3_id){let group_filter=level-1;$wrap_grid.children().remove();if(group_items.length===0){switch(group_filter){case 1:item_filtered=db.from("tb_item_master").where(w=>{return w.Group1===group1_id;});break;case 2:item_filtered=db.from("tb_item_master").where(w=>{return w.Group1===group1_id&&w.Group2===group2_id;});break;case 3:item_filtered=db.from("tb_item_master").where(w=>{return w.Group1===group1_id&&w.Group2===group2_id&&w.Group3===group3_id;});break;}
apply_pagination_order($wrap_grid,item_filtered);}
else{$.each(group_items,function(i,item){var data="";if(level===1){group1_id=item.ItemG1ID;data='<div data-group="'+level+'" data-group1="'+group1_id+'" data-group2="'+group2_id+'" data-group3="'+group3_id+'" data-step="'+item.Name+'" data-id="'+item.ItemG1ID+'" hidden></div>'}
else if(level===2){group2_id=item.ItemG2ID;data='<div data-group="'+level+'" data-group1="'+group1_id+'" data-group2="'+group2_id+'" data-group3="'+group3_id+'" data-step="'+item.Name+'" data-id="'+item.ItemG2ID+'" hidden></div>'}
else{group3_id=item.ID;data='<div data-group="'+level+'" data-group1="'+group1_id+'" data-group2="'+group2_id+'" data-group3="'+group3_id+'" data-step="'+item.Name+'" data-id="'+item.ID+'" hidden></div>'}
let $grid=$("<div class='grid'></div>").append(data).append('<div class="grid-caption">'+item.Name+'</div>');let $grid_image=$("<div class='grid-image'></div>").append('<img src="/Images/itemgroup/'+item.Images+'"/>');$grid.append($grid_image);$grid.on("click",gridClicked);$wrap_grid.append($grid);});}};function MultiItemFiltered($wrap_grid){if(db.from("tb_multi_item")===0){return;}
$.each(db.from("tb_multi_item"),function(i,item){if(item.Image===null||item.Image===''){item.Image='no-image.jpg';}
var data="";data='<div data-group="'+4+'" data-group1="'+0+'" data-group2="'+0+'" data-group3="'+0+'" data-step="'+item.KhmerName+'" data-id="'+item.ItemID+'" hidden></div>'
let $grid=$("<div class='grid'></div>").append(data).append('<div class="grid-caption">'+item.KhmerName+'</div>');let $grid_image=$("<div class='grid-image'></div>").append('<img src="/Images/'+item.Image+'"/>');$grid.append($grid_image);$grid.on("click",gridClicked);$wrap_grid.append($grid);});};function singleItem($wrap_grid,item_filtered){$pagination.twbsPagination('destroy');$wrap_grid.children().remove();$.each(item_filtered,function(i,item){if(item.Image===null||item.Image===''){item.Image='no-image.jpg';}
let dis="%";if(item.TypeDis!="Percent")
dis="";let KhmerName=item.KhmerName+' ('+item.UoM+')';let $grid=$("<div class='grid'></div>");$grid.append('<div data-bonus="'+item.DiscountRate+'" data-id="'+item.ID+'" hidden></div>')
$grid.append('<div class="grid-caption" title='+KhmerName+' >'+KhmerName+' </div > ');let $grid_image=$("<div class='grid-image'></div>");$grid_image.append($("<i class='fas fa-calculator fa-lg fn-sky order-calc'></i>").on("click",openCalculator));let $wrap_scale=$('<div class="wrap-scale">'
+'<i class="scale-down">-</i>'
+'<label data-scale="'+item.PrintQty+'" class="scale">'+item.PrintQty+'</label>'
+'<i class="scale-up">+</i>'
+'</div>');if(item.PrintQty!==0){$wrap_scale.addClass("show");}else{$wrap_scale.removeClass("show");}
$wrap_scale.appendTo($grid_image);if(item.DiscountRate>0){$('<div class="discount">'+item.DiscountRate+' '+dis+' </div>').appendTo($grid_image);}
$grid_image.append('<img src="/Images/'+item.Image+'"/>','<div class="price">'+item.UnitPrice.toFixed(3)+'</div>').appendTo($grid);if(item.KhmerName!==item.EnglishName){$('<div class="grid-caption" title='+item.EnglishName+' >'+item.Code+' '+item.EnglishName+'</div>').appendTo($grid);}
else{$('<div class="grid-caption" title='+item.EnglishName+' >'+item.Code+'</div>').appendTo($grid);}
$wrap_grid.append($grid.on("click",bindToTable));});};function singleItemFiltered($wrap_grid,item_filtered){db.table("tb_multi_item").clear();$wrap_grid.children().remove();$.each(item_filtered,function(i,item){let multiy_item=db.from("tb_item_master").where(w=>{return w.ItemID==item.ItemID;});if(multiy_item.length>1){db.insert("tb_multi_item",item,"ItemID");}
else{if(item.Image===null||item.Image===''){item.Image='no-image.jpg';}
let KhmerName=item.KhmerName+' ('+item.UoM+')';let dis="%";if(item.TypeDis!=="Percent")
dis="";let $grid=$("<div class='grid' "+displayRecords[i]+"></div>");$grid.append('<div data-bonus="'+item.DiscountRate+'" data-id="'+item.ID+'" hidden></div>');$grid.append('<div class="grid-caption" title='+KhmerName+' >'+KhmerName+' </div > ');let $grid_image=$("<div class='grid-image'></div>");$grid_image.append($("<i class='fas fa-calculator fa-lg fn-sky order-calc'></i>").on("click",openCalculator));let $wrap_scale=$('<div class="wrap-scale">'
+'<i class="scale-down">-</i>'
+'<label data-scale="'+item.PrintQty+'" class="scale">'+item.PrintQty+'</label>'
+'<i class="scale-up">+</i>'
+'</div>');$wrap_scale.appendTo($grid_image);if(item.PrintQty!=0){$wrap_scale.addClass("show");}else{$wrap_scale.removeClass("show");}
$wrap_scale.appendTo($grid_image);if(item.DiscountRate>0)
$('<div class="discount">'+item.DiscountRate+' '+dis+' </div>').appendTo($grid_image);$grid_image.append('<img src="/Images/'+item.Image+'"/>','<div class="price">'+item.UnitPrice+'</div>').appendTo($grid);if(item.KhmerName!==item.EnglishName){$('<div class="grid-caption" title='+item.EnglishName+' >'+item.Code+' '+item.EnglishName+'</div>').appendTo($grid);}
else{$('<div class="grid-caption" title='+item.EnglishName+' >'+item.Code+'</div>').appendTo($grid);}
$wrap_grid.append($grid.on("click",bindToTable));}});MultiItemFiltered($wrap_grid);};function summaryTotal(selected_id,option){if(db.from('tb_order_detail')!=0){$('#count-item').text('('+db.from('tb_order_detail').where(w=>{return w.Qty>0}).length+')');db.from("tb_order_detail").where(function(item){if(item.Currency!='KHR'||item.Currency!='៛'){item.UnitPrice=parseFloat(item.UnitPrice).toFixed(3);item.Total=parseFloat(item.Total).toFixed(3);item.Total_Sys=parseFloat(item.Total_Sys).toFixed(3);}
if(parseFloat(item.Qty).toString().includes('.')||parseFloat(item.PrintQty).toString().includes('.')){if(parseFloat(item.Qty)<1||parseFloat(item.PrintQty)<1){item.Qty=parseFloat(item.Qty.toFixed(2));item.PrintQty=parseFloat(item.PrintQty.toFixed(3));}}});}
else{$('#count-item').text('')}
if(option==='Y'){if(db.from("tb_order_detail")!=0){$.bindRows("#item-listview",db.from("tb_order_detail").where(w=>{return w.Qty>0}),'Line_ID',{highlight_row:parseFloat(selected_id),scalable:{column:"Qty",event:"click",callback:rowScaleClicked},text_align:[{"KhmerName":"left"},{"Code":"left"}],scrollview:{block:"center"},html:[{column:-1,insertion:"replace",element:'<i class="fa fa-trash trash csr-pointer" title="Delete"></i>',listener:["click",function(e){rowDelete(this);}]}],prebuild:function(data){},postbuild:function(data){if(data.ItemType=='Item'){$("td:nth-child(3)",this).prop("title","Click to add comment").on("click",rowCommentClicked).addClass('csr-pointer');$("td:nth-child(7)",this).prop("title","Double click to copy item").on("dblclick",rowCopyItem).addClass('csr-pointer');}
if(data.ItemType=='Item'&&data.ItemStatus=='new'){$("td:nth-child(5)",this).prop("title","Double click add on item").on("dblclick",function(){parent_row=$(this).parent();addOnItem(parent_row);}).addClass('csr-pointer');}
else if(data.ItemType=='Addon'){$(this).find("td:nth-child(3)").html("<i style='left:50%; position:absolute; bottom:10%' class='fas fa-plus-circle fn-green fa-xs'></i>");}},show_key:false,hidden_columns:["Line_ID","Description","ParentLevel","Comment","PrintQty","ItemStatus","TypeDis","DiscountValue","UomID","ItemID","OrderDetailID","Total_Sys","EnglishName","Cost","Currency","ItemPrintTo","ItemType"]});}}
function rowCopyItem(e){let item={};let id=parseInt($(this).parent().data('line_id'));let item_master=db.table('tb_order_detail').get(id);let new_line_id=parseInt(db.from('tb_order_detail').length)+1;item.Line_ID=parseInt(id+'3'+new_line_id);item.OrderDetailID=0;item.Code=item_master.Code;item.ItemID=item_master.ItemID;item.KhmerName=item_master.KhmerName;item.EnglishName=item_master.EnglishName;item.UnitPrice=parseFloat(item_master.UnitPrice);item.Cost=item_master.Cost;item.Qty=1;item.UoM=item_master.UoM;item.PrintQty=1;item.DiscountRate=parseFloat(item_master.DiscountRate);item.TypeDis=item_master.TypeDis;item.ItemStatus='new';item.Currency=item_master.Currency;if(item_master.ItemType!='Service'){if(item.TypeDis==='Percent'){item.Total=((item.Qty*item.UnitPrice)*(1-(item.DiscountRate / 100)));item.DiscountValue=((item.Qty*item.UnitPrice)*item.DiscountRate)/ 100;}
else{item.Total=((item.Qty*item.UnitPrice)-item.DiscountRate);item.DiscountValue=item.DiscountRate;}}
else{let time=getTimeOnTable();var arr_time=time.split(':');let h=parseInt(arr_time[0]);let m=parseInt(arr_time[1]);item.Qty=h+(m*0.01);let price=(item.UnitPrice*h)+(item.UnitPrice / 60)*m;if(item.TypeDis==='Percent'){item.Total=(price*(1-(item.DiscountRate / 100)));item.DiscountValue=price*item.DiscountRate / 100;}
else{item.Total=(price-item.DiscountRate);item.DiscountValue=item.DiscountRate;}}
item.Total_Sys=item.Total*local_currency.ratein;item.UomID=item_master.UomID;item_master.PrintQty=item.PrintQty;item.ItemPrintTo=item_master.ItemPrintTo;item.Comment='';item.ItemType=item_master.ItemType;item.Description=item_master.Description;item.ParentLevel=item.Line_ID.toString();db.insert('tb_order_detail',item,'Line_ID');summaryTotal(item.Line_ID,'Y');};function rowCommentClicked(e){let id=parseInt($(this).parent().data('line_id'));rowInitFromComment(id);};function rowEditName(e){let line_id=parseInt($(this).parent().data('line_id'));let item=db.get('tb_order_detail').get(line_id);let dlg=new DialogBox({position:"center-left",content:{selector:"#order-editname",class:'login'},icon:"fas fa-edit",button:{ok:{text:"OK",callback:function(e){item.KhmerName=this.meta.content.find('.order-khname').val();summaryTotal(line_id,'Y');this.meta.shutdown();}}}});dlg.startup("after",function(dialog){dialog.content.find('.order-khname').val(item.KhmerName);dialog.content.find('.order-khname').focus();});};let sub_total=0;let discount_symbol='%';let item_ordered=db.from("tb_order_detail");$.each(item_ordered,function(i,item){sub_total+=parseFloat(item.Total);});if(isNaN(sub_total)){sub_total=0;}
order_master.Sub_Total=sub_total;if(order_master.TypeDis==='Percent'){order_master.DiscountValue=order_master.Sub_Total*order_master.DiscountRate / 100;discount_symbol='%';}
else{order_master.DiscountValue=order_master.DiscountRate;discount_symbol=local_currency.symbol;}
let vat=(order_master.TaxRate+100)/ 100;let rate=order_master.TaxRate / 100;order_master.TaxValue=(order_master.Sub_Total / vat)*rate;order_master.GrandTotal=order_master.Sub_Total-order_master.DiscountValue;order_master.GrandTotal_Sys=order_master.GrandTotal*local_currency.ratein;if(local_currency.symbol==='KHR'||local_currency.symbol==='៛'){$("#summary-sub-total").text(local_currency.symbol+" "+numeral(order_master.Sub_Total).format('0.000'));$("#summary-bonus").text(order_master.DiscountRate+" "+discount_symbol);$("#summary-vat").text(local_currency.symbol+" "+numeral(order_master.TaxValue).format('0.000'));$("#summary-total").text(local_currency.symbol+" "+numeral(order_master.GrandTotal).format('0.000'));}
else{$("#summary-sub-total").text(local_currency.symbol+" "+order_master.Sub_Total.toFixed(3));$("#summary-bonus").text(order_master.DiscountRate+" "+discount_symbol);$("#summary-vat").text(local_currency.symbol+" "+order_master.TaxValue.toFixed(3));$("#summary-total").text(local_currency.symbol+" "+order_master.GrandTotal.toFixed(3));}}
let parentLevel="";function bindToTable(e){let scale=$(this).find(".grid-image .wrap-scale .scale");let scale_down=$(this).find(".grid-image .wrap-scale .scale-down");let scale_up=$(this).find(".grid-image .wrap-scale .scale-up");let id=$(this).children().data("id");let item_master=db.from("tb_item_master").where(function(json){return json.ID===id;})[0];if(item_master.ItemType=='Addon'){addNewItemAddon(scale,item_master);return;}
let item={};let check_item=db.table("tb_order_detail").find(id);if(item_master.PrintQty==0){if(check_item===undefined){item.Line_ID=item_master.ID;item.OrderDetailID=0;item.Code=item_master.Code;item.ItemID=item_master.ItemID;item.KhmerName=item_master.KhmerName;item.EnglishName=item_master.EnglishName;item.UnitPrice=parseFloat(item_master.UnitPrice);item.Cost=item_master.Cost;item.Qty=1;item.UoM=item_master.UoM;item.PrintQty=1;item.DiscountRate=parseFloat(item_master.DiscountRate);item.TypeDis=item_master.TypeDis;item.ItemStatus='new';item.Currency=item_master.Currency;if(item_master.ItemType!='Service'){if(item.TypeDis==='Percent'){item.Total=((item.Qty*item.UnitPrice)*(1-(item.DiscountRate / 100)));item.DiscountValue=((item.Qty*item.UnitPrice)*item.DiscountRate)/ 100;}
else{item.Total=((item.Qty*item.UnitPrice)-item.DiscountRate);item.DiscountValue=item.DiscountRate;}}
else{let time=getTimeOnTable();var arr_time=time.split(':');let h=parseInt(arr_time[0]);let m=parseInt(arr_time[1]);item.Qty=h+(m*0.01);let price=(item.UnitPrice*h)+(item.UnitPrice / 60)*m;if(item.TypeDis==='Percent'){item.Total=(price*(1-(item.DiscountRate / 100)));item.DiscountValue=price*item.DiscountRate / 100;}
else{item.Total=(price-item.DiscountRate);item.DiscountValue=item.DiscountRate;}}
item.Total_Sys=item.Total*local_currency.ratein;item.UomID=item_master.UomID;item_master.PrintQty=item.PrintQty;item.ItemPrintTo=item_master.PrintTo;item.Comment='';item.ItemType=item_master.ItemType;item.Description=item_master.Description;item.ParentLevel=item_master.ID.toString();}
else{item=db.get("tb_order_detail").get(id);if(item.ItemType!='Service'){if(item.PrintQty==0){item.Qty=((item.Qty)+1);item.UoM=item_master.UoM;item.PrintQty=(item.PrintQty+1);if(item_master.ItemType!=='Service'){if(item.TypeDis==='Percent'){item.Total=((item.Qty*item.UnitPrice)*(1-(item.DiscountRate / 100)));item.DiscountValue=((item.Qty*item.UnitPrice)*item.DiscountRate)/ 100;}
else{item.Total=((item.Qty*item.UnitPrice)-item.DiscountRate);item.DiscountValue=item.DiscountRate;}}
else{let time=getTimeOnTable();var arr_time=time.split(':');let h=parseInt(arr_time[0]);let m=parseInt(arr_time[1]);item.Qty=h+m*0.01;let price=(item.UnitPrice*h)+(item.UnitPrice / 60)*m;if(item.TypeDis==='Percent'){item.Total=(price*(1-(item.DiscountRate / 100)));item.DiscountValue=price*item.DiscountRate / 100;}
else{item.Total=(price-item.DiscountRate);item.DiscountValue=item.DiscountRate;}}
item.Total_Sys=item.Total*local_currency.ratein;}}}}
db.insert("tb_order_detail",item,'Line_ID');db.insert('tb_show_item',item_master,'ID');scale.data("scale",item.PrintQty);scale.text(item.PrintQty);$(this).find(".wrap-scale").addClass("show").siblings(".order-calc").addClass("show");if($(e.target).is(scale_up)){item=db.get("tb_order_detail").get(id);if(item.ItemType!=='Service'){item.Qty=(parseFloat(item.Qty)+1);item.PrintQty=(parseFloat(item.PrintQty)+1);item_master.PrintQty=parseFloat(item.PrintQty);if(item.TypeDis=="Percent"){item.Total=((item.Qty*item.UnitPrice)*(1-(item.DiscountRate / 100)));item.DiscountValue=(item.Qty*item.UnitPrice)*item.DiscountRate / 100;}
else{item.Total=((item.Qty*item.UnitPrice)-item.DiscountRate);item.DiscountValue=item.DiscountRate;}
item.Total_Sys=item.Total*local_currency.ratein;item.UomID=item_master.UomID;if(item.PrintQty===0){$(this).find(".wrap-scale").removeClass("show").siblings(".order-calc").removeClass("show");}}}
if($(e.target).is(scale_down)){item=db.get("tb_order_detail").get(id);if(item.ItemType!='Service'){if(item.Qty>0){if(item.PrintQty>0){item.Qty=(item.Qty-1);item.PrintQty=(item.PrintQty-1);item_master.PrintQty=item.PrintQty;}
if(item.TypeDis=="Percent"){item.Total=((item.Qty*item.UnitPrice)*(1-(item.DiscountRate / 100)));item.DiscountValue=(item.Qty*item.UnitPrice)*item.DiscountRate / 100;}
else{item.Total=((item.Qty*item.UnitPrice)-item.DiscountRate);item.DiscountValue=item.DiscountRate;}
item.Total_Sys=item.Total*local_currency.ratein;item.UomID=item_master.UomID;if(item.ItemStatus=='old'){if(item.PrintQty==0){$(this).find(".wrap-scale").removeClass("show").siblings(".order-calc").removeClass("show");}
if(item.PrintQty<0){let minus=1;if(item.PrintQty<1){minus=parseFloat(item.PrintQty).toPrecision(3);$(this).find(".wrap-scale").removeClass("show").siblings(".order-calc").removeClass("show");}
item.Qty=(item.Qty-minus);item.PrintQty=(item.PrintQty-minus);item_master.PrintQty=item.PrintQty;if(item.TypeDis=="Percent"){item.Total=((item.Qty*item.UnitPrice)*(1-(item.DiscountRate / 100)));item.DiscountValue=(item.Qty*item.UnitPrice)*item.DiscountRate / 100;}
else{item.Total=((item.Qty*item.UnitPrice)-item.DiscountRate);item.DiscountValue=item.DiscountRate;}
item.Total_Sys=item.Total*local_currency.ratein;if(item.Qty<=0){$(this).find(".wrap-scale").removeClass("show").siblings(".order-calc").removeClass("show");}}}
else{if(item.PrintQty<=0){let item_master=db.from("tb_item_master").where(function(json){return json.ID===id;})[0];item_master.Qty=0;item_master.PrintQty=0;db.insert('tb_show_item',item_master,'ID');db.table("tb_order_detail").delete(id);$(this).find(".wrap-scale").removeClass("show").siblings(".order-calc").removeClass("show");let rows=$("#item-listview").children().children();$.each(rows,function(i,row){let row_id=parseInt($(row).data("line_id"));if(row_id===id){$(row).remove();}});summaryTotal(id,'Y');return;}}}}}
db.update("tb_order_detail",item,'Line_ID');db.update("tb_show_item",item_master,'ID');scale.data("scale",item.PrintQty);scale.text(item.PrintQty);summaryTotal(item.Line_ID,'Y');};function rowDelete(row){let item_ordered=db.table("tb_order_detail");let $row=$(row).parent().parent();let line_id=$row.data("line_id");let check_item=db.table("tb_order_detail").get(line_id);let item_master=db.table("tb_show_item").get(line_id);if(item_master==undefined){item_master=db.table("tb_show_item_barcode").get(line_id);}
let grids=$("#group-item-gridview .wrap-grid .grid");if(check_item.ItemStatus=='new'){if(item_master!=undefined){item_master.PrintQty=0;db.table("tb_order_detail").delete(line_id);db.update("tb_order_detail",item_ordered,"Line_ID");db.update("tb_show_item",item_master,"ID");$row.remove();$.each(grids,function(i,grid){let grid_id=$(grid).children().data("id");if(grid_id===line_id){if(db.from('tb_show_item_barcode')!=0){db.table('tb_show_item_barcode').delete(line_id);$(grid).remove();}
else{$(grid).find(".wrap-scale").removeClass("show").siblings(".order-calc").removeClass("show");}}});}
else{db.table("tb_order_detail").delete(line_id);db.update("tb_order_detail",item_ordered,"Line_ID");$row.remove();}
summaryTotal(line_id,'Y');}
else{confirmDeleteItem(row);}};function getTimeOnTable(){let time=$.ajax({url:'/POS/GetTimeByTable',async:false,type:'GET',data:{TableID:table_info.id}}).responseText;return time;};function confirmDeleteItem(row){let $row=$(row).parent().parent();let line_id=$row.data("line_id");let item_master=db.table("tb_item_master").get(line_id);let grids=$("#group-item-gridview .wrap-grid .grid");let user_privillege=db.table("tb_user_privillege").get('P011');if(user_privillege.Used===false){let dlg=new DialogBox({position:"top-center",content:{selector:"#admin-authorization",class:"login"},icon:"fas fa-lock",button:{ok:{text:"Login",callback:function(e){let access=accessSecurity(this.meta.content,'P011');if(access===false){this.meta.content.find('.error-security-login').text('You can not access ...!');return;}
else{this.meta.content.find('.security-username').focus();this.meta.setting.icon="fas fa-lock fa-spin";this.text="Logging...";this.meta.content.find('.error-security-login').text('');this.meta.build(this.setting);setTimeout(()=>{this.meta.build(this.setting);this.meta.setting.icon="fas fa-unlock-alt";setTimeout(()=>{this.meta.shutdown();if(item_master!=undefined){item=db.get("tb_order_detail").get(line_id);item_master.PrintQty=0;item.PrintQty=parseFloat(item.Qty)*(-1);item.Qty=0;db.update("tb_order_detail",item,"Line_ID");db.update("tb_item_master",item_master,"ID");$row.remove();$.each(grids,function(i,grid){let grid_id=$(grid).children().data("id");if(grid_id===line_id){$(grid).find(".wrap-scale").removeClass("show");}});}
else{item=db.get("tb_order_detail").get(line_id);item.PrintQty=parseFloat(item.Qty)*(-1);item.Qty=0;db.update("tb_order_detail",item,"Line_ID");$row.remove();}
summaryTotal(line_id,'Y');},100);},500);}}}}});}
else{if(item_master!=undefined){item=db.get("tb_order_detail").get(line_id);item_master.PrintQty=0;item.PrintQty=parseFloat(item.Qty)*(-1);item.Qty=0;db.update("tb_order_detail",item,"Line_ID");db.update("tb_item_master",item_master,"ID");}
else{item=db.get("tb_order_detail").get(line_id);item.PrintQty=parseFloat(item.Qty)*(-1);item.Qty=0;db.update("tb_order_detail",item,"Line_ID");db.update("tb_item_master",item_master,"ID");}
$row.remove();$.each(grids,function(i,grid){let grid_id=$(grid).children().data("id");if(grid_id===line_id){$(grid).find(".wrap-scale").removeClass("show");}});summaryTotal(line_id,'Y');if(item.ItemType=='Service'){getTimeOnTable();}}};function row_hovered(e){$(this).siblings().removeClass("highlight");};function rowScaleClicked(e){let item={};let $row=$(this).parent().parent();let line_id=$row.data("line_id");item_master=db.get("tb_item_master").get(line_id);let scale=$(this).children(".scale");if($(e.target).is($(".scale-up"))){item=db.get("tb_order_detail").get(line_id);if(item.ItemType!='Service'){if(item_master!=undefined){item.Qty=item.Qty+1;item.PrintQty=item.PrintQty+1;item_master.PrintQty=item.PrintQty;}
else{item.Qty=item.Qty+1;item.PrintQty=item.PrintQty+1;}
if(item.TypeDis=="Percent"){item.Total=(((item.Qty*item.UnitPrice)*(1-(item.DiscountRate / 100)))).toPrecision(3);item.DiscountValue=(item.Qty*item.UnitPrice)*item.DiscountRate / 100;}
else{item.Total=(((item.Qty*item.UnitPrice)-item.DiscountRate)).toPrecision(3);item.DiscountValue=item.DiscountRate;}
item.Total_Sys=(item.Total*local_currency.ratein).toPrecision(3);$(this).parent().parent()[0].cells[14].innerHTML=item.Total;db.update("tb_order_detail",item,"Line_ID");db.update("tb_item_master",item_master,"ID");scale.data("scale",item.Qty);scale.text(item.Qty);if(item_master!=undefined){updateSclaeGrids($row,item);}
summaryTotal(line_id,'N');}}
if($(e.target).is($(".scale-down"))){confirmReduceQty(line_id,$(this),$row);}};function updateSclaeGrids($row,item){let grids=$("#group-item-gridview .wrap-grid .grid");$.each(grids,function(i,grid){let grid_id=$(grid).children().data("id");if(grid_id===item.Line_ID){if(item.PrintQty>0){$(grid).find(".wrap-scale").addClass("show");}
if(item.ItemStatus==='new'){if(item.PrintQty==0){db.table("tb_order_detail").delete(item.Line_ID);$(grid).find(".wrap-scale").removeClass("show");$row.remove();let row_list=$('#item-listview').children().children();$.each(row_list,function(i,row_remove){let data_id=parseInt($(row_remove).data("line_id"));if(item.Line_ID===data_id){$(row_remove).remove();}});}}
else{if(item.Qty==0){$(grid).find(".wrap-scale").removeClass("show");$(grid).remove();$row.remove();}
if(item.PrintQty<0){$(grid).find(".wrap-scale").addClass("show");}
if(item.PrintQty==0){$(grid).find(".wrap-scale").removeClass("show");}}
$(grid).find(".scale").data("scale",item.PrintQty);$(grid).find(".scale").text(item.PrintQty);}});};function confirmReduceQty(line_id,parent,$row){let user_privillege=db.table("tb_user_privillege").get('P009');if(user_privillege.Used===false){let dlg=new DialogBox({position:"top-center",content:{selector:"#admin-authorization",class:"login"},icon:"fas fa-lock",button:{ok:{text:"Login",callback:function(e){let access=accessSecurity(this.meta.content,'P009');if(access===false){this.meta.content.find('.error-security-login').text('You can not access ...!');return;}
else{this.meta.content.find('.security-username').focus();this.meta.setting.icon="fas fa-lock fa-spin";this.text="Logging...";this.meta.content.find('.error-security-login').text('');this.meta.build(this.setting);setTimeout(()=>{this.meta.build(this.setting);this.meta.setting.icon="fas fa-unlock-alt";setTimeout(()=>{this.meta.shutdown();initReduceQty(line_id,parent,$row);},100);},500);}}}}});}
else{initReduceQty(line_id,parent,$row);}};function initReduceQty(line_id,parent,$row){let item={};item_master=db.get("tb_show_item").get(line_id);let scale=parent.children(".scale");item=db.get("tb_order_detail").get(line_id);if(item.ItemType!='Service'){if(item_master!=undefined){let minus=1;if(item.Qty<1){minus=parseFloat(item.Qty);}
item.Qty=item.Qty-minus;item.PrintQty=item.PrintQty-minus;item_master.PrintQty=item.PrintQty;}
else{let minus=1;if(item.Qty<1){minus=parseFloat(item.Qty);}
item.Qty=item.Qty-minus;item.PrintQty=item.PrintQty-minus;}
if(item.TypeDis=="Percent"){item.Total=(((item.Qty*item.UnitPrice)*(1-(item.DiscountRate / 100)))).toPrecision(3);item.DiscountValue=(item.Qty*item.UnitPrice)*item.DiscountRate / 100;}
else{item.Total=(((item.Qty*item.UnitPrice)-item.DiscountRate)).toPrecision(3);item.DiscountValue=item.DiscountRate;}
item.Total_Sys=(item.Total*local_currency.ratein).toPrecision(3);if(item.Qty<=0){if(item_master!=undefined){updateSclaeGrids($row,item);}
summaryTotal(line_id,'N');$row.remove();return;}
parent.parent().parent()[0].cells[14].innerHTML=item.Total;db.update("tb_order_detail",item,"Line_ID");db.update("tb_item_master",item_master,"ID");scale.data("scale",item.Qty);scale.text(item.Qty);if(item_master!=undefined){updateSclaeGrids($row,item);}
summaryTotal(line_id,'N');}};function apply_pagination_order($wrap_grid,items){records=items;totalRecords=records.length;totalPages=Math.ceil(totalRecords / recPerPage);displayRecordsIndex=Math.max(page-1,0)*recPerPage;endRec=(displayRecordsIndex)+recPerPage;displayRecords=records.slice(displayRecordsIndex,endRec);singleItemFiltered($wrap_grid,displayRecords);$pagination.twbsPagination('destroy');$pagination.twbsPagination({totalPages:totalPages,visiblePages:5,onPageClick:function(e,page){displayRecordsIndex=Math.max(page-1,0)*recPerPage;endRec=(displayRecordsIndex)+recPerPage;displayRecords=records.slice(displayRecordsIndex,endRec);singleItemFiltered($wrap_grid,displayRecords);}});};let calc=null;function openCalculator(e){e.preventDefault();calc=new DialogCalculator();calc.accept(e=>{let qty=parseFloat(calc.self.find(".navigator.output").text());let grid=$(this).parent().parent();let line_id=parseInt($(grid).children().data('id'));calc.shutdown("before",function(){if(qty<0){return;}
calulateQty(line_id,qty,grid);});});$(this).parent().addClass("active");$(this).parent().parent().parent().addClass("active").siblings().removeClass("active").find(".wrap-scale").removeClass("active");};function calulateQty(id,qty,grid){let item_master=db.from("tb_item_master").where(function(json){return json.ID===id;})[0];item=db.get("tb_order_detail").get(id);if(item.ItemStatus=='new'){if(item.ItemType!=='Service'){item.Qty=parseFloat(qty)
item.PrintQty=parseFloat(qty)
item_master.PrintQty=item.PrintQty;if(item.TypeDis=="Percent"){item.Total=((item.Qty*item.UnitPrice)*(1-(item.DiscountRate / 100)));item.DiscountValue=(item.Qty*item.UnitPrice)*item.DiscountRate / 100;}
else{item.Total=((item.Qty*item.UnitPrice)-item.DiscountRate);item.DiscountValue=item.DiscountRate;}
item.Total_Sys=item.Total*local_currency.ratein;item.UomID=item_master.UomID;if(item.PrintQty==0){item_master.PrintQty=0;$(grid).find(".wrap-scale").removeClass("show").siblings(".order-calc").removeClass("show");}
db.update("tb_order_detail",item,'Line_ID');db.update("tb_show_item",item_master,'ID');grid.find(".scale").data("scale",item_master.PrintQty);grid.find(".scale").text(item_master.PrintQty);summaryTotal(id,'Y');}}
else{if(item.ItemType!=='Service'){if(item_master.PrintQty==0){item.Qty=(item.Qty+parseFloat(qty)-1);item.PrintQty=((item.PrintQty+parseFloat(qty))-1);item_master.PrintQty=item.PrintQty;}
else{item.Qty=item.Qty+parseFloat(qty);item.PrintQty=(item.PrintQty+parseFloat(qty));item_master.PrintQty=item.PrintQty;}
if(item.TypeDis=="Percent"){item.Total=((item.Qty*item.UnitPrice)*(1-(item.DiscountRate / 100)));item.DiscountValue=(item.Qty*item.UnitPrice)*item.DiscountRate / 100;}
else{item.Total=((item.Qty*item.UnitPrice)-item.DiscountRate);item.DiscountValue=item.DiscountRate;}
item.Total_Sys=item.Total*local_currency.ratein;item.UomID=item_master.UomID;if(item.PrintQty==0){item_master.PrintQty=0;$(grid).find(".wrap-scale").removeClass("show").siblings(".order-calc").removeClass("show");}
grid.find(".scale").data("scale",item_master.PrintQty);grid.find(".scale").text(item_master.PrintQty);db.update("tb_order_detail",item,'Line_ID');db.update("tb_show_item",item_master,'ID');summaryTotal(id,'Y');}}};﻿function returnItemsNotStock(items){let msg=new DialogBox({caption:"Item not enough in stock",content:{selector:"#items-return"},position:"top-center",type:"ok"});msg.setting.animation.shutdown.animation_type="slide-up";msg.setting.button.ok.callback=function(e){this.meta.shutdown();};$.bindRows("#items-return-listview",items,'Line_ID',{text_align:[{"KhmerName":"left"},{"In Stock":"center"},{"Ordered Qty":"center"}],show_key:false,hidden_columns:["Line_ID","ItemID"]});};function rowReturnScaleClicked(e){let item={};let $row=$(this).parent().parent();let line_id=$row.data("line_id");item_master=db.get("tb_item_master").get(line_id);let scale=$(this).children(".scale");if($(e.target).is($(".scale-up"))){item=db.get("tb_order_detail").get(line_id);item.Qty=item.Qty+1;item.PrintQty=item.PrintQty+1;item_master.PrintQty=item.PrintQty;if(item.TypeDis==="Percent"){item.Total=((item.Qty*item.UnitPrice)*(1-(item.DiscountRate / 100)));item.DiscountValue=(item.Qty*item.UnitPrice)*item.DiscountRate / 100;}
else{item.Total=((item.Qty*item.UnitPrice)-item.DiscountRate);item.DiscountValue=item.DiscountRate;}
item.Total_Sys=item.Total*local_currency.ratein;}
if($(e.target).is($(".scale-down"))){item=db.get("tb_order_detail").get(line_id);item.Qty=item.Qty-1;item.PrintQty=item.PrintQty-1;item_master.PrintQty=item.PrintQty;if(item.TypeDis==="Percent"){item.Total=((item.Qty*item.UnitPrice)*(1-(item.DiscountRate / 100))).toFixed(2);item.DiscountValue=(item.Qty*item.UnitPrice)*item.DiscountRate / 100;}
else{item.Total=((item.Qty*item.UnitPrice)-item.DiscountRate).toFixed(2);item.DiscountValue=item.DiscountRate;}
item.Total_Sys=item.Total*local_currency.ratein;if(item.PrintQty<=0){$row.remove();db.insert("tb_order_detail",item,"Line_ID");db.table("tb_order_detail").delete(line_id);db.insert("tb_item_master",item_master,"ID");scale.data("scale",item.PrintQty);scale.text(item.PrintQty);updateSclaeGrids($row,item);summaryTotal(0,'Y');return;}}
db.insert("tb_order_detail",item,"Line_ID");db.insert("tb_item_master",item_master,"ID");scale.data("scale",item.PrintQty);scale.text(item.PrintQty);updateSclaeGrids($row,item);summaryTotal(0,'Y');};function rowItemReturnDelete(){};﻿$("#goto-main-menu").click(function(e){let main_menu=new DialogBox({icon:"far fa-list-alt",close_button:true,content:{selector:"#main-menu-content",},caption:"Menu",position:"top-center",type:"ok",button:{ok:{text:"Close",callback:function(e){this.meta.shutdown();}}}});let main_menu_setting=main_menu.setting;main_menu.setting.button.ok.text="Cancel";main_menu.setting.animation.shutdown.animation_type="slide-up";});$('#goto-set-print-receipt').click(function(e){confirmSetPrinter();});function confirmSetPrinter(){let user_privillege=db.table("tb_user_privillege").get('P016');if(user_privillege.Used===false){let dlg=new DialogBox({position:"top-center",content:{selector:"#admin-authorization",class:"login"},icon:"fas fa-lock",button:{ok:{text:"Login",callback:function(e){let access=accessSecurity(this.meta.content,'P016');if(access===false){this.meta.content.find('.error-security-login').text('You can not access ...!');return;}
else{this.meta.content.find('.security-username').focus();this.meta.setting.icon="fas fa-lock fa-spin";this.text="Logging...";this.meta.content.find('.error-security-login').text('');this.meta.build(this.setting);setTimeout(()=>{this.meta.build(this.setting);this.meta.setting.icon="fas fa-unlock-alt";setTimeout(()=>{initFromSetprintReceipt();},100);},500);}}}}});}
else{initFromSetprintReceipt();}};function initFromSetprintReceipt(){let set_printer=new DialogBox({position:"top-center",caption:"Set Printer Name",content:{selector:"#set-print-receipt-content"},animation:{startup:{delay:0,duration:0}},button:{ok:{text:"Done",callback:function(e){let content=$(this.meta.content);let PrinterName={Name:content.find(".set-printer-name").val(),MachineName:""};$.ajax({url:'/POS/SetPrinterName',async:false,type:'POST',data:{printer:PrinterName},success:function(){}});this.meta.shutdown();}}},icon:"fas fa-print"});};$("#goto-reprint").click(function(e){confirmReprint();});function confirmReprint(){let user_privillege=db.table("tb_user_privillege").get('P014');if(user_privillege.Used===false){let dlg=new DialogBox({position:"top-center",content:{selector:"#admin-authorization",class:"login"},icon:"fas fa-lock",button:{ok:{text:"Login",callback:function(e){let access=accessSecurity(this.meta.content,'P014');if(access===false){this.meta.content.find('.error-security-login').text('You can not access ...!');return;}
else{this.meta.content.find('.security-username').focus();this.meta.setting.icon="fas fa-lock fa-spin";this.text="Logging...";this.meta.content.find('.error-security-login').text('');this.meta.build(this.setting);setTimeout(()=>{this.meta.build(this.setting);this.meta.setting.icon="fas fa-unlock-alt";setTimeout(()=>{initFormReprint();},100);},500);}}}}});}
else{initFormReprint();}};function initFormReprint(){let reprint=new DialogBox({position:"top-center",caption:"Reprint",content:{selector:"#reprint-content"},animation:{startup:{delay:0,duration:0}},button:{ok:{text:"Done",callback:function(e){this.meta.shutdown();}}},icon:"fas fa-print"});reprint.startup("before",function(dialog){let receipts=$.ajax({url:'/POS/GetReceiptReprint',async:false,type:'GET',data:{branchid:order_info.branchid,date_from:null,date_to:null},success:function(){}}).responseJSON;initDataReceipt(receipts);});};$("#goto-setting").click(function(e){confirmSetting();});function confirmSetting(){let user_privillege=db.table("tb_user_privillege").get('P015');if(user_privillege.Used===false){let dlg=new DialogBox({position:"top-center",content:{selector:"#admin-authorization",class:"login"},icon:"fas fa-lock",button:{ok:{text:"Login",callback:function(e){let access=accessSecurity(this.meta.content,'P015');if(access===false){this.meta.content.find('.error-security-login').text('You can not access ...!');return;}
else{this.meta.content.find('.security-username').focus();this.meta.setting.icon="fas fa-lock fa-spin";this.text="Logging...";this.meta.content.find('.error-security-login').text('');this.meta.build(this.setting);setTimeout(()=>{this.meta.build(this.setting);this.meta.setting.icon="fas fa-unlock-alt";setTimeout(()=>{initFormSetting();},100);},500);}}}}});}
else{initFormSetting();}};function initFormSetting(){let pos_setting=new DialogBox({position:"top-center",caption:"Setting",content:{selector:"#setting-content"},animation:{startup:{delay:0,duration:0}},button:{ok:{text:"Done",callback:function(e){processSetSetting(this.meta.content);this.meta.shutdown();window.location.reload();}}},icon:"fas fa-cogs"});pos_setting.startup("after",function(dialog){initDataSetting(dialog.content);});};$("#open-shift").click(function(e){confirmOpenShift();});function confirmOpenShift(){let user_privillege=db.table("tb_user_privillege").get('P012');if(user_privillege.Used===false){let dlg=new DialogBox({position:"top-center",content:{selector:"#admin-authorization",class:"login"},icon:"fas fa-lock",button:{ok:{text:"Login",callback:function(e){let access=accessSecurity(this.meta.content,'P012');if(access===false){this.meta.content.find('.error-security-login').text('You can not access ...!');return;}
else{this.meta.content.find('.security-username').focus();this.meta.setting.icon="fas fa-lock fa-spin";this.text="Logging...";this.meta.content.find('.error-security-login').text('');this.meta.build(this.setting);setTimeout(()=>{this.meta.build(this.setting);this.meta.setting.icon="fas fa-unlock-alt";setTimeout(()=>{initFormOpenShift();},100);},500);}}}}});}
else{initFormOpenShift();}};function initFormOpenShift(){let open_shift=new DialogBox({caption:"Cash In",content:{selector:"#open-shift-content"},position:"top-center",animation:{startup:{delay:0,duration:0}},type:"ok-cancel",icon:"far fa-money-bill-alt",button:{ok:{text:"Done",callback:function(e){this.meta.shutdown();}}}});let currencies=[];open_shift.startup("before",function(dialog){$.each(db.from("tb_exchange_rate"),function(i,exchange){let curr={};curr.id=exchange.CurrencyID;curr.index=i+1+". ";curr.cash='Cash';curr.input_cash="";curr.currency=exchange.Currency.Description;curr.ratein=exchange.Rate;curr.total=0;currencies.push(curr);});$.bindRows(".open-cash-in",currencies,"id",{html:[{column:"input_cash",insertion:"replace",element:"<input autofocus class='input-cash'>",listener:["keyup",function(e){this.value=_$_.validNumber(this.value);if(this.value.length===0){this.value=0;}
let id=parseFloat($(this).parent().parent().data("id"));let cash=this.value;let curr=currencies.find(w=>w.id===id);let sys_currency=currencies.find(w=>w.id===setting.SysCurrencyID);curr.total=curr.ratein*cash;total_cash=sumTotal(currencies);$(".cash-in-total").text(sys_currency.currency+" "+total_cash);}],}],show_key:false,hidden_columns:["id","ratein","total"]});$("input.input-cash").val("0");});open_shift.confirm(function(e){processOpenShift(sumTotal(currencies));OpenShift();this.meta.shutdown();$(".cash-in-total").text("0.000");});open_shift.reject(function(e){this.meta.shutdown();$(".cash-in-total").text("0.000");});};$("#close-shift").click(function(e){confirmCloseShift();});function confirmCloseShift(){let user_privillege=db.table("tb_user_privillege").get('P013');if(user_privillege.Used===false){let dlg=new DialogBox({position:"top-center",content:{selector:"#admin-authorization",class:"login"},icon:"fas fa-lock",button:{ok:{text:"Login",callback:function(e){let access=accessSecurity(this.meta.content,'P013');if(access===false){this.meta.content.find('.error-security-login').text('You can not access ...!');return;}
else{this.meta.content.find('.security-username').focus();this.meta.setting.icon="fas fa-lock fa-spin";this.text="Logging...";this.meta.content.find('.error-security-login').text('');this.meta.build(this.setting);setTimeout(()=>{this.meta.build(this.setting);this.meta.setting.icon="fas fa-unlock-alt";setTimeout(()=>{initFormCloseShift();},100);},500);}}}}});}
else{initFormCloseShift();}};function initFormCloseShift(){let close_shift=new DialogBox({caption:"Cash Out",content:{selector:"#close-shift-content"},position:"top-center",animation:{startup:{delay:0,duration:0}},type:"ok-cancel",icon:"far fa-money-bill-alt",button:{ok:{text:"Done",callback:function(e){this.meta.shutdown();}}}});let currencies=[];close_shift.startup("before",function(dialog){$(".close-cash-out").empty();$.each(db.from("tb_exchange_rate"),function(i,exchange){let curr={};curr.id=exchange.CurrencyID;curr.index=i+1+". ";curr.cash='Cash';curr.input_cash="";curr.currency=exchange.Currency.Description;curr.ratein=exchange.Rate;curr.total=0;currencies.push(curr);});$.bindRows(".close-cash-out",currencies,"id",{html:[{column:"input_cash",insertion:"replace",element:"<input autofocus class='input-cash'>",listener:["keyup",function(e){this.value=_$_.validNumber(this.value);if(this.value.length===0){this.value=0;}
let id=parseFloat($(this).parent().parent().data("id"));let cash=this.value;let curr=currencies.find(w=>w.id===id);let sys_currency=currencies.find(w=>w.id===setting.SysCurrencyID);curr.total=curr.ratein*cash;total_cash=sumTotal(currencies);$(".cash-out-total").text(sys_currency.currency+" "+total_cash);}]}],show_key:false,hidden_columns:["id","ratein","total"]});$("input.input-cash").val("0");});close_shift.confirm(function(e){processCloseShift(sumTotal(currencies));db.map("tb_check_open_shift").clear();window.location.href="/Account/Login";this.meta.shutdown();$(".cash-out-total").text("0.000");});close_shift.reject(function(e){this.meta.shutdown();$(".cash-out-total").text("0.000");});};function sumTotal(array){for(var
index=0,length=array.length,sum=0;index<length;sum+=array[index++].total);return sum;};function initDataSetting(content){content.find('.print-receipt-order').prop('checked',setting.PrintReceiptOrder);content.find('.print-receipt-pay').prop('checked',setting.PrintReceiptTender);content.find('.print-receipt-count').val(setting.PrintCountReceipt);content.find('.max-queue-count').val(setting.QueueCount);content.find(".receipt-size").val(setting.Receiptsize);content.find(".receipt-template").val(setting.ReceiptTemplate);content.find(".printer-id").val(setting.Printer);content.find('.dual-screen').prop('checked',setting.DaulScreen);content.find('.vat-able').prop('checked',setting.VatAble);content.find('.vat-invoice-no').val(setting.VatNum);content.find('.password-wifi').val(setting.Wifi);content.find('.customer-id').val(setting.CustomerID);content.find('.price-list-id').val(setting.PriceListID);content.find('.receipt-other-curr').val(setting.CurrencyDisplay);content.find('.other-curr-rate').val(setting.DisplayRate);content.find('.warehouse-id').val(setting.WarehouseID);content.find('.payment-means-id').val(setting.PaymentMeansID);};function processSetSetting(content){setting.PrintReceiptOrder=content.find(".print-receipt-order").is(":checked");setting.PrintReceiptTender=content.find(".print-receipt-pay").is(":checked");setting.PrintCountReceipt=parseInt(content.find('.print-receipt-count').val());setting.QueueCount=parseInt(content.find('.max-queue-count').val());setting.Receiptsize=content.find(".receipt-size option:selected").text();setting.ReceiptTemplate=content.find('.receipt-template option:selected').text();setting.Printer=parseInt(content.find(".printer-id").val());setting.DaulScreen=content.find('.dual-screen').is(':checked');setting.VatAble=content.find('.vat-able').is(':checked');setting.VatNum=content.find('.vat-invoice-no').val();setting.Wifi=content.find('.password-wifi').val();setting.CustomerID=parseInt(content.find('.customer-id').val());setting.PriceListID=parseInt(content.find('.price-list-id').val());setting.CurrencyDisplay=content.find('.receipt-other-curr').text();setting.DisplayRate=parseFloat(content.find('.other-curr-rate').val());setting.WarehouseID=parseInt(content.find('.warehouse-id').val());setting.PaymentMeansID=parseInt(content.find('.payment-means-id').val());$.ajax({url:'/POS/UpdateSetting',type:'POST',data:{setting:setting},dataType:'JSON',success:function(response){}});};function initDataReceipt(receipts){db.map("tb_reprint").clear();$.each(receipts,function(i,receipt){let rec={};rec.orderid=receipt.ReceiptID;rec.receipt_no=receipt.ReceiptNo;rec.cashier=receipt.UserAccount.Employee.Name;rec.dateout=receipt.DateOut.slice(0,10);rec.timeout=receipt.TimeOut;if(local_currency.symbol==='KHR'||local_currency.symbol==='៛'){rec.amount=numeral(receipt.GrandTotal).format('0.000');}
else{rec.amount=receipt.GrandTotal.toFixed(2);}
rec.currency=receipt.Currency.Description;db.insert("tb_reprint",rec,"orderid");});$.bindRows(".reprint-receipt-listview",db.from("tb_reprint"),"orderid",{text_align:[{"cashier":"left"}],html:[{column:-1,insertion:"replace",element:'<div class=btn><i class="fa fa-print"></i></div>',listener:["click",function(e){rowClickedPrint(this);}]}],show_key:false,hidden_columns:["orderid"]});};function rowClickedPrint(row){let orderid=parseInt($(row).parent().parent().data("orderid"));$.ajax({url:"/POS/PrintReceiptReprint",async:false,type:"POST",data:{orderid:orderid,print_type:"Reprint"},success:function(){}});};let date_to=null;let date_from=null;$('.reprint-date-to').change(function(){date_to=$(this).val();let receipts=$.ajax({url:'/POS/GetReceiptReprint',async:false,type:'GET',data:{branchid:order_info.branchid,date_from:date_from,date_to:date_to},success:function(){}}).responseJSON;initDataReceipt(receipts);});$('.reprint-date-from').change(function(){date_from=$(this).val();});$('input[name="search-receipt-reprint"]').keyup(function(){let query=$(this).val().toLowerCase();let receipts=db.from("tb_reprint").where(w=>{return w.receipt_no.toLowerCase().includes(query)||w.cashier.toLowerCase().includes(query);});$.bindRows(".reprint-receipt-listview",receipts,"orderid",{text_align:[{"cashier":"left"}],html:[{column:-1,insertion:"replace",element:'<div class=btn><i class="fa fa-print"></i></div>',listener:["click",function(e){rowClickedPrint(this);}]}],show_key:false,hidden_columns:["orderid"]});});function processOpenShift(total_cash_in){$.ajax({url:'/POS/OpenShift',type:'POST',async:false,data:{userid:order_info.user,cash:total_cash_in},success:function(response){}});};function processCloseShift(total_cash_out){let loader=null;loader=new AjaxLoader("/pos/icons/ajax-loader/loading.gif");$.ajax({url:'/POS/CloseShift',type:'POST',async:false,data:{userid:order_info.user,cashout:total_cash_out},success:function(response){loader.close();}});};﻿$('#log-out-pos').click(function(){let msg=new DialogBox({caption:"Log out",content:"Do you want to log out ?",position:"top-center",type:"ok-cancel",icon:"info"});msg.setting.button.ok.callback=function(e){window.location.href="/Account/Login";};msg.reject(function(e){this.meta.shutdown();});});$('#change-password-user').click(function(){let msg=new DialogBox({caption:"Change Password",content:{selector:"#user-change-pass"},position:"top-center",type:"ok-cancel",icon:"info"});msg.setting.button.ok.callback=function(e){};msg.reject(function(e){this.meta.shutdown();});});﻿$("#goto-panel-group-items").click(function(e){$("#panel-payment").removeClass("show");$("#panel-group-tables").removeClass("show");$(".nav-header .min-max").addClass("show");clearPayment();});$(".goto-panel-group-tables").click(function(e){$("#panel-group-tables").addClass("show");$("#panel-payment").removeClass("show");$("#panel-group-items").removeClass("show");$(".nav-header .min-max").removeClass("show");clearPayment();});let curr_sys_symbol=db.from("tb_exchange_rate").where(w=>{return w.CurrencyID===setting.SysCurrencyID});$('.print-receipt-pay').prop('checked',setting.PrintReceiptTender);$('.payment-means-id').val(setting.PaymentMeansID);$('.sys-symbol').text(curr_sys_symbol[0].Currency.Description);$('.other-curr-symbol').text(curr_sys_symbol[0].Currency.Description);$("#goto-panel-payment").on("click",function(){let user_privillege=db.table("tb_user_privillege").get('P008');if(user_privillege.Used===false){let dlg=new DialogBox({position:"top-center",content:{selector:"#admin-authorization",class:"login"},icon:"fas fa-lock",button:{ok:{text:"Login",callback:function(e){let access=accessSecurity(this.meta.content,'P008');if(access===false){this.meta.content.find('.error-security-login').text('You can not access ...!');return;}
else{this.meta.content.find('.security-username').focus();this.meta.setting.icon="fas fa-lock fa-spin";this.text="Logging...";this.meta.content.find('.error-security-login').text('');this.meta.build(this.setting);setTimeout(()=>{this.meta.build(this.setting);this.meta.setting.icon="fas fa-unlock-alt";setTimeout(()=>{confirmPay();},100);},500);}}}}});}
else{confirmPay();}});function confirmPay(){if(db.from("tb_check_open_shift")===0){let msg=new DialogBox({caption:"Information",content:"Please open shift before pay...!",position:"top-center",type:"ok",icon:"info"});msg.setting.button.ok.callback=function(e){this.meta.shutdown();}
return;}
if($("#item-listview").find('tr:not(:first-child)').length!==0){let total_pay=fx.convert(order_master.GrandTotal,{from:fx.base,to:dis_curr[0].AltCurr});if(dis_curr[0].AltCurr==='KHR'||dis_curr[0].AltCurr==='៛'){$('#pay-total-sys').val(numeral(total_pay).format('0.000'));}
else{$('#pay-total-sys').val(total_pay.toFixed(2));}
$('.display-symbol').text(dis_curr[0].AltCurr);calulatePayment();}
else{let msg=new DialogBox({caption:"Information",content:"Data was empty...!",position:"top-center",type:"ok",icon:"info"});msg.setting.button.ok.callback=function(e){this.meta.shutdown();}
return;}
gotoPaymentPanel();};function gotoPaymentPanel(){$("#panel-payment").addClass("show");$("#panel-group-tables").removeClass("show");$("#panel-group-items").addClass("hide");$(".nav-header .min-max").removeClass("show");setTimeout(()=>{$("#panel-payment input#pay-cash").val("").focus();},100);};$("#pay-cash").keyup(function(){let check=parseFloat($("#pay-cash").val());if(isNaN(check)){$('#pay-cash').val(0);$('#pay-change-display-curr-fx').val('');}
calulatePayment();});$("#pay-other-currency").keyup(function(){let value=parseFloat($("#pay-other-currency").val());let cash=parseFloat($("#pay-cash").val());if(isNaN(cash)){$('#pay-cash').val(0);$('#pay-change-display-curr-fx').val('');}
if(isNaN(value)){$('#pay-other-currency').val(0);$('#pay-change-display-curr-fx').val('');}
if(isNaN(value)){$('#pay-other-currency').val(0);$('#pay-change-display-curr-fx').val('');}
calulatePayment();});$("#pay-payment-means").keyup(function(){let check=parseFloat($("#pay-payment-means").val());if(isNaN(check)){$('#pay-payment-means').val(0);}
calulatePayment();});$('#other-currency-list').change(function(){$('.other-curr-symbol').text($(this).find("option:selected").text());let value=parseFloat($("#pay-other-currency").val());let cash=parseFloat($("#pay-cash").val());if(isNaN(cash)){$('#pay-cash').val(0);$('#pay-change-display-curr-fx').val('');}
if(isNaN(value)){$('#pay-other-currency').val(0);$('#pay-change-display-curr-fx').val('');}
calulatePayment();});$('.payment-means-id').change(function(){$('#pay-cash').focus();});$("#pay").click(function(){pay();});$('#pay-cash').keypress(function(event){var keycode=(event.keyCode?event.keyCode:event.which);if(keycode=='13'){pay();}});function pay(){if(order_master.Change>=0){if(order_master.OrderID===0){$("#send").text("Sending ...");sendData(0,'Pay');}
else{$("#send").text("Updating ...");sendData(order_master.OrderID,'Pay');}
$("#panel-group-items").addClass("show");$("#panel-group-items").removeClass("hide");$(".nav-header .min-max").addClass("show");clearPayment();}
else{let msg=new DialogBox({caption:"Information",content:"Cash not engouh ...!",position:"top-center",type:"ok",icon:"info"});msg.setting.button.ok.callback=function(e){this.meta.shutdown();};}};function calulatePayment(){let cash=parseFloat($('#pay-cash').val());let pay_means=parseFloat($('#pay-payment-means').val());if(isNaN(pay_means)){pay_means=0;}
let pay_other_curr=parseFloat($('#pay-other-currency').val());let dis_alt_curr=$('.other-curr-symbol').text();let conv_other_pay=fx.convert(pay_other_curr,{from:dis_alt_curr,to:fx.base});order_master.Received=cash+pay_means+conv_other_pay;order_master.Change=order_master.Received-(order_master.GrandTotal);let conv_curr_change=fx.convert(order_master.Change,{from:fx.base,to:dis_curr[0].AltCurr});order_master.PaymentMeansID=$("pay-payment-means-id").val();if(order_master.Change<0){$(".error_enghoug").css("color","red");$('#pay-received').css("color","black");}
else{$(".error_enghoug").css("color","green");$('#pay-received').css("color","red");let to_curr=db.from('tb_display_curr');var change=order_master.Change.toString().split('.');let fix_change=parseFloat('.'+change[1]);let fixed_change=fx.convert(fix_change,{from:fx.base,to:to_curr[0].AltCurr});if(!isNaN(fix_change)){if(dis_curr[0].AltCurr==='KHR'||dis_curr[0].AltCurr==='៛'){$('#pay-change-display-curr-fx').val(fx.base+' '+fix_change.toFixed(3)+'= '+to_curr[0].AltCurr+' '+numeral(fixed_change).format('0.000'));}
else{$('#pay-change-display-curr-fx').val(fx.base+' '+fix_change.toFixed(3)+'= '+to_curr[0].AltCurr+' '+fixed_change);}}
else{$('#pay-change-display-curr-fx').val('');}}
if(local_currency.symbol=='KHR'||local_currency.symbol=='៛'){$("#pay-total").val(numeral(order_master.GrandTotal).format('0.000'));$('#pay-received').val(numeral(order_master.Received).format('0.000'));$('#pay-change').val(numeral(order_master.Change).format('0.000'));$('#pay-change-display-curr').val(numeral(conv_curr_change).format('0.000'));}
else{$("#pay-total").val(order_master.GrandTotal.toFixed(3));$('#pay-received').val(order_master.Received.toFixed(3));$('#pay-change').val(order_master.Change.toFixed(3));$('#pay-change-display-curr').val(numeral(conv_curr_change).format('0.000'));}};function clearPayment(){$("#pay-total").val(0);$("#pay-change").val(0);$('#pay-change-sys').val(0);$('#pay-cash').val(0);$('#pay-other-currency').val(0);$('#pay-payment-means').val(0);$('#pay-cash').val(0);$('#pay-change-display-curr-fx').val('');};const number_pad=$("#panel-payment .number-pad .grid");const quick_number=$("#panel-payment .quick-number .grid");let value="";var input_flag=$();$(".number").val(0);$(".number").prop("maxlength",12);number_pad.click(function(e){let input_value=input_flag.value;if(input_value!==undefined&&input_value.length<=12){setTimeout(()=>{input_flag.selectionStart=input_flag.value.length;$(input_flag).focus();},0);value=input_value+$(this).data("value").toString();value=_$_.validNumber(value);input_flag.value=value;if($(this).data("value")===-1){input_flag.value=input_value.substring(0,input_value.length-1);if(input_flag.value===""){input_flag.value=0;}}
calulatePayment();}});let q_val=0;quick_number.click(function(e){let value=parseFloat($("#pay-other-currency").val());let cash=parseFloat($("#pay-cash").val());if(isNaN(cash)){$('#pay-cash').val(0);$('#pay-change-display-curr-fx').val('');}
if(isNaN(value)){$('#pay-other-currency').val(0);$('#pay-change-display-curr-fx').val('');}
q_val=parseFloat($(input_flag).val());q_val+=parseFloat($(this).data("value"));$(input_flag).val(q_val);calulatePayment();});$("input[class=number]").focus(function(e){input_flag=this;});let timer;$(".number").on("keyup",function(e){clearTimeout(timer);timer=setTimeout(()=>{if(parseFloat(this.value)===0){this.value=0;}},1500);if(this.value===""&&e.keyCode===8){this.value=0;}
this.value=_$_.validNumber(this.value);});﻿$("#dbl-return-item").click(function(e){confirmReturnReceipt();});function confirmReturnReceipt(){let user_privillege=db.table("tb_user_privillege").get('P021');if(user_privillege.Used===false){let dlg=new DialogBox({position:"top-center",content:{selector:"#admin-authorization",class:"login"},icon:"fas fa-lock",button:{ok:{text:"Login",callback:function(e){let access=accessSecurity(this.meta.content,'P021');if(access===false){this.meta.content.find('.error-security-login').text('You can not access ...!');return;}
else{this.meta.content.find('.security-username').focus();this.meta.setting.icon="fas fa-lock fa-spin";this.text="Logging...";this.meta.content.find('.error-security-login').text('');this.meta.build(this.setting);setTimeout(()=>{this.meta.build(this.setting);this.meta.setting.icon="fas fa-unlock-alt";setTimeout(()=>{initFromReturnReceipt();},100);},500);}}}}});}
else{initFromReturnReceipt();}};let dlg_return=null;function initFromReturnReceipt(){dlg_return=new DialogBox({position:"top-center",caption:"Return Item",type:'ok-cancel',content:{selector:"#item-return-order"},button:{ok:{text:"Apply",callback:function(e){if(db.from('tb_item_return')!=0){processReutunItem();}
else{$('.error-return-item').text('Error : Can not return, because data empty...!');}}}},icon:"fas fa-receipt"});dlg_return.reject(function(e){this.meta.shutdown();})
dlg_return.startup("before",function(dialog){$.ajax({url:'/POS/GetReceiptReturn',type:'GET',dataType:'JSON',data:{branchid:order_info.branchid,date_from:null,date_to:null},success:function(receipts){initDataReturnReceipt(receipts);}});});};function initDataReturnReceipt(receipts){let list=dlg_return.content.find('.return-invoice-listview');$.bindRows(list,receipts,"ReceiptID",{show_key:false,hidden_columns:["ReceiptID"],postbuild:function(){$(this).on("click",function(){rowClickedReturn(this);});}});};function rowClickedReturn(row){let receipt_id=$(row).data('receiptid');$.ajax({url:'/POS/GetReceiptReturnDetail',type:'GET',dataType:'JSON',data:{ReceiptID:receipt_id},success:function(detail){initDataReturnReceiptDetail(detail,receipt_id);}});};function initDataReturnReceiptDetail(details,receipt_id){let list=dlg_return.content.find('.item-return-choosed-listview');db.table('tb_item_return').clear();$.each(details,function(i,detail){let ReturnItem={};ReturnItem.id=detail.ID;ReturnItem.receipt_id=receipt_id;ReturnItem.item_id=detail.ItemID;ReturnItem.code=detail.Code;if(detail.Name!='manual'){ReturnItem.kh=detail.KhmerName+'('+detail.Name+')';}
else{ReturnItem.kh=detail.KhmerName;}
ReturnItem.openQty=detail.OpenQty;ReturnItem.returnQty=0;db.insert('tb_item_return',ReturnItem,"id");})
$.bindRows(list,db.from('tb_item_return'),"id",{show_key:false,hidden_columns:["id","receipt_id","returnQty","item_id"],postbuild:function(){let input=$("<td></td>").append($("<input>").on("keyup",editReturnQty))
let icon=$("<td></td>").append($("<i class='fas fa-trash trash csr-pointer'></i>").on("click",removeReturnQty));$(this).append(input).append(icon);}});};function editReturnQty(){let line_id=$(this).parent().parent().data('id');let item_return=db.table('tb_item_return').get(line_id);let qty=parseFloat($(this).val());item_return.returnQty=qty;db.insert("tb_item_return",item_return,"id");};function removeReturnQty(){let line_id=$(this).parent().parent().data('id');$(this).parent().parent().remove();db.table("tb_item_return").delete(line_id);};function processReutunItem(){let loader=null;loader=new AjaxLoader("/pos/icons/ajax-loader/loading.gif");$.ajax({url:'/POS/SendReturnItem',type:'POST',dataType:"JSON",data:{returnItems:db.from('tb_item_return')},success:function(response){if(response.status==false){$('.error-return-item').text('Error : Can not return, because one or more item qty bigger than original qty...!');}
else{db.table('tb_item_return').clear();let list=dlg_return.content.find('.item-return-choosed-listview');$.bindRows(list,db.from('tb_item_return'),"id",{});$('.error-return-item').text('Successfully...').removeClass('trash').css("color","green");setTimeout(()=>{$('.error-return-item').text('').css("color","red");},1000);}
loader.close();}});};$('#txt-item-return-search').keyup(function(){var value=$(this).val().toLowerCase();$(".return-invoice-listview").filter(function(){$(this).toggle($(this).text().toLowerCase().indexOf(value)>-1)});});let date_to_return=null;let date_from_return=null;$('.return-date-from').change(function(){date_from_return=$(this).val();});$('.return-date-to').change(function(){date_to_return=$(this).val();$.ajax({url:'/POS/GetReceiptReturn',type:'GET',dataType:'JSON',data:{branchid:order_info.branchid,date_from:date_from_return,date_to:date_to_return},success:function(receipts){initDataReturnReceipt(receipts);}});});﻿var $pagination=$('#pagination'),totalRecords=0,records=[],displayRecords=[],recPerPage=28,page=1,totalPages=0,currentPage=1;$("#item-search").on('keyup',function(){let item_filtered=[];setTimeout(function(){let value=$("#item-search").val().toLowerCase();item_filtered=db.from("tb_item_master").where(w=>{return w.EnglishName.toLowerCase().includes(value)||w.KhmerName.includes(value)||w.Code.toLowerCase().includes(value);});apply_pagination(item_filtered);},180);});function apply_pagination(items){records=items;totalRecords=records.length;totalPages=Math.ceil(totalRecords / recPerPage);displayRecordsIndex=Math.max(page-1,0)*recPerPage;endRec=(displayRecordsIndex)+recPerPage;displayRecords=records.slice(displayRecordsIndex,endRec);singleItemSearch(displayRecords);$pagination.twbsPagination('destroy');$pagination.twbsPagination({totalPages:totalPages,visiblePages:3,onPageClick:function(e,page){displayRecordsIndex=Math.max(page-1,0)*recPerPage;endRec=(displayRecordsIndex)+recPerPage;displayRecords=records.slice(displayRecordsIndex,endRec);singleItemSearch(items);}});};function singleItemSearch(){const $wrap_grid=$("#group-item-gridview .wrap-grid");db.map("tb_show_item_barcode").clear();$wrap_grid.children().remove();$.each(displayRecords,function(i,item){if(item.Image===null||item.Image===''){item.Image='no-image.jpg';}
let dis="%";if(item.TypeDis!="Percent")
dis="";let KhmerName=item.KhmerName;if(item.UoM!=='manual')
KhmerName=item.KhmerName+' ('+item.UoM+')';let $grid=$("<div class='grid'​​​ "+displayRecords[i]+"></div>");$grid.append('<div data-bonus="'+item.DiscountRate+'" data-id="'+item.ID+'" hidden></div>')
$grid.append('<div class="grid-caption" title='+KhmerName+' >'+KhmerName+' </div > ');let $grid_image=$("<div class='grid-image'></div>");$grid_image.append($("<i class='fas fa-calculator fa-lg fn-sky order-calc'></i>").on("click",openCalculator));let $wrap_scale=$('<div class="wrap-scale">'
+'<i class="scale-down">-</i>'
+'<label data-scale="'+item.PrintQty+'" class="scale">'+item.PrintQty+'</label>'
+'<i class="scale-up">+</i>'
+'</div>');if(item.PrintQty!==0){$wrap_scale.addClass("show");}else{$wrap_scale.removeClass("show");}
$wrap_scale.appendTo($grid_image);if(item.DiscountRate>0){$('<div class="discount">'+item.DiscountRate+' '+dis+' </div>').appendTo($grid_image);}
$grid_image.append('<img src="/Images/'+item.Image+'"/>','<div class="price">'+item.UnitPrice+'</div>').appendTo($grid);if(item.KhmerName!==item.EnglishName){$('<div class="grid-caption" title='+item.EnglishName+' >'+item.Code+' '+item.EnglishName+'</div>').appendTo($grid);}
else{$('<div class="grid-caption" title='+item.EnglishName+' >'+item.Code+'</div>').appendTo($grid);}
$wrap_grid.append($grid.on("click",bindToTable));});};$(".close-barcode").on('click',function(){});$("#open-barcode").on('click',function(){});let count=0;let counts=0;$("#item-search-barcode").keypress(function(event){let item={};let barcode;let $wrap_grid=$("#group-item-gridview .wrap-grid");var keycode=(event.keyCode?event.keyCode:event.which);if(keycode=='13'){if(db.from("tb_show_item_barcode")===0){$wrap_grid.children().remove();$pagination.twbsPagination('destroy');}
barcode=$("#item-search-barcode").val().toLowerCase();var scaleprice=barcode.slice(7,12);var scale_unitprice=Number(scaleprice / 100).toFixed(3);let item_filtered=$.ajax({url:"/POS/GetItemMasterByBarcode",async:false,type:"GET",dataType:"JSON",data:{pricelist:setting.PriceListID,barcode:barcode,scaleprice:scale_unitprice},error:function(){$("#item-search-barcode").val("");}}).responseJSON;if(item_filtered==null||item_filtered==undefined){return;}
$.each(item_filtered,function(i,item_master){let uom_definded=db.from('tb_group_uom_defined').where(w=>{return w.GroupUoMID==item_master.GroupUomID;});console.log(item_filtered)
if(item_master.UoM.toLowerCase()=="kg"){let item_ordered=db.table("tb_show_item_barcode").get(item_master.ID);if(item_ordered==undefined){count=item_master.Qty;}
else{let item_update=db.get('tb_show_item_barcode').get(item_master.ID);count=item_update.PrintQty+item_master.Qty;}}else{let item_ordered=db.table("tb_show_item_barcode").get(item_master.ID);if(item_ordered==undefined){count=1;}
else{let item_update=db.get('tb_show_item_barcode').get(item_master.ID);count=item_update.PrintQty+1;}}
if(item_master.UomID==uom_definded[0].AltUOM){item.Line_ID=item_master.ID;item.OrderDetailID=0;item.Code=item_master.Code;item.ItemID=item_master.ItemID;item.KhmerName=item_master.KhmerName;item.EnglishName=item_master.EnglishName;item.UnitPrice=parseFloat(item_master.UnitPrice);item.Cost=item_master.Cost;item.Qty=count;item.UoM=item_master.UoM;item.PrintQty=count;item.DiscountRate=parseFloat(item_master.DiscountRate);item.TypeDis=item_master.TypeDis;item.ItemStatus='new';item.Currency=item_master.Currency;if(item.TypeDis==='Percent'){item.Total=(item.Qty*item.UnitPrice)*(1-(item.DiscountRate / 100));item.DiscountValue=((item.Qty*item.UnitPrice)*item.DiscountRate)/ 100;}
else{item.Total=((item.Qty*item.UnitPrice)-item.DiscountRate);item.DiscountValue=item.DiscountRate;}
item.Total_Sys=(item.Total*local_currency.ratein);item.UomID=item_master.UomID;item_master.PrintQty=count;item.ItemPrintTo=item_master.PrintTo;item.Comment='';item.ItemType=item_master.ItemType;item.Description=item_master.Description;db.insert("tb_order_detail",item,'Line_ID');db.insert('tb_item_master',item_master,'ID');singleItemFilteredBarcode($wrap_grid,item_master);$("#item-search-barcode").val("");summaryTotal(item.Line_ID,'Y');}
else{let item_ordered=db.table("tb_show_item_barcode").get(item_master.ID);if(item_ordered==undefined){counts=0;}
else{let item_update=db.get('tb_show_item_barcode').get(item_master.ID);counts=item_update.PrintQty;}
item_master.Qty=counts;item_master.PrintQty=counts;singleItemFilteredBarcode($wrap_grid,item_master);}});$("#item-search-barcode").val("");}});function singleItemFilteredBarcode($wrap_grid,item){let grids=$("#group-item-gridview .wrap-grid .grid");if(db.from('tb_show_item_barcode')===0){db.insert("tb_show_item_barcode",item,"ID");$wrap_grid.children().remove();if(item.Image===null||item.Image===''){item.Image='no-image.jpg';}
let KhmerName=item.KhmerName;if(item.UoM!=='manual')
KhmerName=item.KhmerName+' ('+item.UoM+')';let dis="%";if(item.TypeDis!=="Percent")
dis="";let $grid=$("<div class='grid'></div>");$grid.append('<div data-bonus="'+item.DiscountRate+'" data-id="'+item.ID+'" hidden></div>');$grid.append('<div class="grid-caption" title='+KhmerName+' >'+KhmerName+' </div > ');let $grid_image=$("<div class='grid-image'></div>");$grid_image.append($("<i class='fas fa-calculator fa-lg fn-sky order-calc'></i>").on("click",openCalculator));let $wrap_scale=$('<div class="wrap-scale">'
+'<i class="scale-down">-</i>'
+'<label data-scale="'+item.PrintQty+'" class="scale">'+item.PrintQty+'</label>'
+'<i class="scale-up">+</i>'
+'</div>');if(item.PrintQty!=0){$wrap_scale.addClass("show");}else{$wrap_scale.removeClass("show");}
$wrap_scale.appendTo($grid_image);if(item.DiscountRate>0)
$('<div class="discount">'+item.DiscountRate+' '+dis+' </div>').appendTo($grid_image);$grid_image.append('<img src="/Images/'+item.Image+'"/>','<div class="price">'+item.UnitPrice+'</div>').appendTo($grid);if(item.KhmerName!==item.EnglishName){$('<div class="grid-caption" title='+item.EnglishName+' >'+item.Code+' '+item.EnglishName+'</div>').appendTo($grid);}
else{$('<div class="grid-caption" title='+item.EnglishName+' >'+item.Code+'</div>').appendTo($grid);}
$wrap_grid.append($grid.on("click",bindToTable));}else{if(item.Image===null||item.Image===''){item.Image='no-image.jpg';}
let KhmerName=item.KhmerName;if(item.UoM!=='manual')
KhmerName=item.KhmerName+' ('+item.UoM+')';let dis="%";if(item.TypeDis!=="Percent")
dis="";let $grid=$("<div class='grid'></div>");$grid.append('<div data-bonus="'+item.DiscountRate+'" data-id="'+item.ID+'" hidden></div>');$grid.append('<div class="grid-caption" title='+KhmerName+' >'+KhmerName+' </div > ');let $grid_image=$("<div class='grid-image'></div>");$grid_image.append($("<i class='fas fa-calculator fa-lg fn-sky order-calc'></i>").on("click",openCalculator));let $wrap_scale=$('<div class="wrap-scale">'
+'<i class="scale-down">-</i>'
+'<label data-scale="'+item.PrintQty+'" class="scale">'+item.PrintQty+'</label>'
+'<i class="scale-up">+</i>'
+'</div>');if(item.PrintQty!=0){$wrap_scale.addClass("show");}else{$wrap_scale.removeClass("show");}
$wrap_scale.appendTo($grid_image)
if(item.DiscountRate>0)
$('<div class="discount">'+item.DiscountRate+' '+dis+' </div>').appendTo($grid_image);$grid_image.append('<img src="/Images/'+item.Image+'"/>','<div class="price">'+item.UnitPrice+'</div>').appendTo($grid);if(item.KhmerName!==item.EnglishName){$('<div class="grid-caption" title='+item.EnglishName+' >'+item.EnglishName+'</div>').appendTo($grid);}
else{$('<div class="grid-caption" title='+item.EnglishName+' >'+ +'</div>').appendTo($grid);}
let item_ordered=db.table('tb_show_item_barcode').get(item.ID);if(item_ordered==undefined){$wrap_grid.append($grid.on("click",bindToTable));}
else{$.each(grids,function(i,grid){let grid_id=parseInt($(grid).children().data("id"));if(grid_id===parseInt(item.ID)){$(grid).find(".scale").data("scale",item.PrintQty);$(grid).find(".scale").text(item.PrintQty);}});}
db.insert("tb_show_item_barcode",item,"ID");}};﻿$("#send").on('click',function(){if(db.from("tb_check_open_shift")===0){let msg=new DialogBox({caption:"Information",content:"Please open shift before send...!",position:"top-center",type:"ok",icon:"info"});msg.setting.button.ok.callback=function(e){this.meta.shutdown();};return;}
if(db.from("tb_order_detail")!==0){if(order_master.OrderID===0){sendData(0,'Send');}
else{$("#send").text("Updating ...");sendData(order_master.OrderID,'Send');}}
else{let msg=new DialogBox({caption:"Information",content:"Data was empty...!",position:"top-center",type:"ok",icon:"info"});msg.setting.button.ok.callback=function(e){this.meta.shutdown();};}});function sendData(orderid,print_type){let loader=null;loader=new AjaxLoader("/pos/icons/ajax-loader/loading.gif");$('#pay').text('Paying...');Order={OrderID:orderid,OrderNo:order_master.OrderNo,TableID:table_info.id,ReceiptNo:order_master.ReceiptNo,QueueNo:order_master.QueueNo,DateIn:new Date(order_master.DateIn),DateOut:new Date(),TimeIn:order_master.TimeIn,TimeOut:date.toLocaleTimeString(),WaiterID:order_master.WaiterID,UserOrderID:order_master.UserOrderID,UserDiscountID:order_master.UserDiscountID,CustomerID:order_master.CustomerID,CustomerCount:order_master.CustomerCount,PriceListID:order_master.PriceListID,LocalCurrencyID:order_master.LocalCurrencyID,SysCurrencyID:order_master.SysCurrencyID,ExchangeRate:order_master.ExchangeRate,WarehouseID:order_master.WarehouseID,BranchID:order_master.BranchID,CompanyID:order_master.CompanyID,Sub_Total:order_master.Sub_Total,DiscountRate:order_master.DiscountRate,DiscountValue:order_master.DiscountValue,TypeDis:order_master.TypeDis,TaxRate:order_master.TaxRate,TaxValue:order_master.TaxValue,GrandTotal:order_master.GrandTotal,GrandTotal_Sys:order_master.GrandTotal_Sys,Received:order_master.Received,Change:order_master.Change,CurrencyDisplay:dis_curr[0].AltCurr,DisplayRate:dis_curr[0].Rate,GrandTotal_Display:fx.convert(order_master.GrandTotal,{from:fx.base,to:dis_curr[0].AltCurr}),Change_Display:fx.convert(order_master.Change,{from:fx.base,to:dis_curr[0].AltCurr}),PLCurrencyID:local_currency.id,PLRate:local_currency.ratein,LocalSetRate:local_rate.SetRate,PaymentMeansID:parseInt($(".payment-means-id-choosed").val()),CheckBill:order_master.CheckBill,OrderDetail:db.from("tb_order_detail"),OrderDetail_Addon:db.from("tb_order_addon")}
$.ajax({url:"/POS/Send",type:"POST",dataType:"JSON",data:{data:JSON.stringify(Order),print_type:print_type},success:function(order_return){if(order_return.length>0){returnItemsNotStock(order_return);$("#panel-group-items").addClass("show");$("#panel-group-items").removeClass("hide");$(".nav-header .min-max").addClass("show");$("#send").text("Send");$('.Table').text("");$('#pay').text('Pay');}
else{$("#send").text("Send");$('.Table').text("");$('#pay').text('Pay');clearOrder();}
loader.close();}});};﻿$("#dbl-split-receipt").click(function(e){confirmSplit();});function confirmSplit(){let user_privillege=db.table("tb_user_privillege").get('P003');if(user_privillege.Used===false){let dlg=new DialogBox({position:"top-center",content:{selector:"#admin-authorization",class:"login"},icon:"fas fa-lock",button:{ok:{text:"Login",callback:function(e){let access=accessSecurity(this.meta.content,'P003');if(access===false){this.meta.content.find('.error-security-login').text('You can not access ...!');return;}
else{this.meta.content.find('.security-username').focus();this.meta.setting.icon="fas fa-lock fa-spin";this.text="Logging...";this.meta.content.find('.error-security-login').text('');this.meta.build(this.setting);setTimeout(()=>{this.meta.build(this.setting);this.meta.setting.icon="fas fa-unlock-alt";setTimeout(()=>{initFormSplit();},100);},500);}}}}});}
else{initFormSplit();}};function initFormSplit(){if($("#item-listview").find('tr:not(:first-child)').length!==0){if(order_master.OrderID!==0){let msg=new DialogBox({caption:"Split Receipt ( "+order_master.OrderNo+" )",content:{selector:"#split-receipt"},position:"top-center",type:"ok-cancel"});msg.setting.animation.shutdown.animation_type="slide-up";msg.setting.button.ok.text="Split";msg.confirm(spitItemTo);msg.reject(function(e){this.meta.shutdown();})
db.map("tb_order_split").clear();$.each(db.from("tb_order_detail"),function(i,item){item_split={};item_split.Line_ID=item.Line_ID;item_split.code=item.Code;item_split.name=item.KhmerName;item_split.qty=parseFloat(item.Qty)-1;item_split.uom=item.UoM;item_split.dis_qty=item.Qty;item_split.symbol="->";item_split.split_qty=1;db.insert("tb_order_split",item_split,"Line_ID");});bindRowSpilt();}
else{let msg=new DialogBox({caption:"Information",content:"Please send data before split...!",position:"top-center",type:"ok",icon:"info"});msg.setting.button.ok.callback=function(e){this.meta.shutdown();};}}
else{let msg=new DialogBox({caption:"Information",content:"Data was empty...!",position:"top-center",type:"ok",icon:"info"});msg.setting.button.ok.callback=function(e){this.meta.shutdown();};}};function processSplit(){$.each(db.from("tb_order_split"),function(i,item_split){let item_update=db.get("tb_order_detail").get(item_split.Line_ID);item_update.Qty=item_split.qty;item_update.PrintQty=item_split.split_qty;if(item_update.TypeDis==="Percent"){item_update.Total=((item_update.Qty*item_update.UnitPrice)*(1-(item_update.DiscountRate / 100)));item_update.DiscountValue=(item_update.Qty*item_update.UnitPrice)*item_update.DiscountRate / 100;}
else{item_update.Total=((item_update.Qty*item_update.UnitPrice)-item_update.DiscountRate);item_update.DiscountValue=istem_update.DiscountRate;}
item_update.Total_Sys=item_update.Total*local_currency.ratein;db.insert("tb_order_detail",item_update,"Line_ID");});summaryTotal(0,'Y');sendDataSplit(order_master.OrderID);};function spitItemTo(){processSplit();this.meta.shutdown();};function sendDataSplit(orderid){let loader=null;loader=new AjaxLoader("/pos/icons/ajax-loader/loading.gif");Order={OrderID:orderid,OrderNo:order_master.OrderNo,TableID:table_info.id,ReceiptNo:order_master.ReceiptNo,QueueNo:order_master.QueueNo,DateIn:order_master.DateIn,DateOut:date.getDate(),TimeIn:order_master.TimeIn,TimeOut:date.toLocaleTimeString(),WaiterID:order_master.WaiterID,UserOrderID:order_master.UserOrderID,UserDiscountID:order_master.UserDiscountID,CustomerID:order_master.CustomerID,CustomerCount:order_master.CustomerCount,PriceListID:order_master.PriceListID,LocalCurrencyID:order_master.LocalCurrencyID,SysCurrencyID:order_master.SysCurrencyID,ExchangeRate:order_master.ExchangeRate,WarehouseID:order_master.WarehouseID,BranchID:order_master.BranchID,CompanyID:order_master.CompanyID,Sub_Total:order_master.Sub_Total,DiscountRate:order_master.DiscountRate,DiscountValue:order_master.DiscountValue,TypeDis:order_master.TypeDis,TaxRate:order_master.TaxRate,TaxValue:order_master.TaxValue,GrandTotal:order_master.GrandTotal,GrandTotal_Sys:order_master.GrandTotal_Sys,Received:order_master.Received,Change:order_master.Change,PaymentMeansID:order_master.PaymentMeansID,CheckBill:'N',OrderDetail:db.from("tb_order_detail"),OrderDetail_Addon:db.from("tb_order_addon")};$.ajax({url:"/POS/SendSplit",type:"POST",dataType:"JSON",data:{data:Order,addnew:Order},success:function(response){clickOnOrderNo(response.TableID,response.OrderID);$.each(db.from("tb_order_detail"),function(i,item){item_split={};item_split.Line_ID=item.Line_ID;item_split.code=item.Code;item_split.name=item.KhmerName;item_split.qty=parseFloat(item.Qty)-1;item_split.dis_qty=item.Qty;item_split.symbol="->";item_split.split_qty=1;db.insert("tb_order_split",item_split,"Line_ID");});bindRowSpilt();console.log('hii...');loader.close();}});};function bindRowSpilt(){let items_split=db.from("tb_order_split");$.bindRows("#split-receipt-listview",items_split,'Line_ID',{scalable:{column:"split_qty",event:"click",callback:rowSpiltClicked},text_align:[{"name":"left"}],html:[{column:-1,insertion:"replace",element:'<i class="fa fa-trash trash"></i>',listener:["click",function(e){rowSpiltDelete(this);}]}],show_key:false,mouseover:row_hovered,hidden_columns:["Line_ID","qty"]});};function rowSpiltDelete(row){let $row=$(row).parent().parent();let line_id=$row.data("line_id");let item_old=db.table("tb_order_detail").get(line_id);let item_split=db.table("tb_order_split").get(line_id);item_split.qty=item_old.Qty;item_split.split_qty=0;db.insert("tb_order_split",item_split,"Line_ID");$row.remove();};function rowSpiltClicked(e){let $row=$(this).parent().parent();let line_id=$row.data("line_id");let scale=$(this).children(".scale");if($(e.target).is($(".scale-up"))){let item_split=db.get("tb_order_split").get(line_id);if(item_split.qty<=0){return;}
item_split.split_qty=item_split.split_qty+1;item_split.qty=item_split.qty-1;db.insert("tb_order_split",item_split,"Line_ID");scale.text(item_split.split_qty);bindRowSpilt();}
if($(e.target).is($(".scale-down"))){let item_old=db.get("tb_order_detail").get(line_id);let item_split=db.get("tb_order_split").get(line_id);item_split.split_qty=item_split.split_qty-1;item_split.qty=item_split.qty+1;if(item_split.split_qty<=0){$(this).parent().parent().remove();item_split.Qty=item_old.Qty;item_split.split_qty=0;db.update("tb_order_split",item_split,"Line_ID");return;}
db.insert("tb_order_split",item_split,"Line_ID");scale.text(item_split.split_qty);}};﻿let group_table=$.ajax({url:"/POS/Table",async:false,type:"GET",dataType:"JSON"}).responseJSON;db.addTable("tb_table_group",group_table.GroupTables,"ID");db.addTable("tb_table",group_table.Tables,"ID");db.select("tb_table_group").each(function(i,group){let group1=$('<div data-id= "'+group.ID+'" class="step">'+group.Name+'</div>');let group2=$('<div data-id= "'+group.ID+'" class="step">'+group.Name+'</div>');$("#move-table-breadcrumb").append(group1.on("click",clickGroupTableOnMove));$(".table-group").append(group2.on("click",clickGroupTable));});getTables(0);function getTables(group_id){$("#table-item-gridview").children().empty();let table_filtered=[];if(group_id===0){table_filtered=db.from("tb_table");}
else if(group_id===-1){var query=($("#table_search").val()).toLowerCase();table_filtered=db.from("tb_table").where(w=>{return w.Name.toLowerCase().includes(query);});}
else{table_filtered=db.from("tb_table").where(w=>{return w.GroupTableID===group_id;});}
$.each(table_filtered,function(i,table){if(table.Image===null||table.Image===''){table.Image='no-image.jpg';}
let userid="user"+table.ID;let grid=$("<div class='grid'></div>").append('<div data-id="'+table.ID+'" data-name="'+table.Name+'" hidden></div>').append('<div class="grid-caption">'+table.Name+'</div>');let grid_image=$("<div class='grid-image'></div>");grid_image.append('<img src="/Images/table/'+table.Image+'"/>');grid.append(grid_image);grid.append("<div id='"+userid+"' class='grid-subtitle'></div>");$("#table-item-gridview").children().append(grid.on("click",tableClicked));});};function clickGroupTableOnMove(){let group_id=$(this).data("id");getTableAvailable(group_id);$(this).siblings().removeClass("active");$(this).addClass("active");};function clickGroupTable(){let group_id=$(this).data("id");$("#table-item-gridview").children().empty();getTables(group_id);$(this).siblings().removeClass("active");$(this).addClass("active");};function tableClicked(e){$("#panel-group-items").addClass("show");$("#panel-group-items").removeClass("hide");$(".nav-header .min-max").addClass("show");table_info.id=$(this).children().data("id");table_info.name=$(this).children().data("name");clickOnOrderNo(table_info.id,0);};$("#all-table-move").on('click',function(){getTableAvailable(0);$(this).siblings().removeClass("active");$(this).addClass("active");});$("#all-table").on('click',function(){getTables(0);$(this).siblings().removeClass("active");$(this).addClass("active");});$('#table_search').on('keyup',function(){getTables(-1);});$('input[name=search-move-table]').on('keyup',function(){var query=($(this).val()).toLowerCase();$('.move-table-list .rc-container').each(function(){var $this=$(this);if($this.text().toLowerCase().indexOf(query)===-1)
$this.closest('.rc-container').hide();else $this.closest('.rc-container').show();});});$("#dbl-move-table").click(function(e){confirmMoveTable();});function confirmMoveTable(){let user_privillege=db.table("tb_user_privillege").get('P001');if(user_privillege.Used===false){let dlg=new DialogBox({position:"top-center",content:{selector:"#admin-authorization",class:"login"},icon:"fas fa-lock",button:{ok:{text:"Login",callback:function(e){let access=accessSecurity(this.meta.content,'P001');if(access===false){this.meta.content.find('.error-security-login').text('You can not access ...!');return;}
else{this.meta.content.find('.security-username').focus();this.meta.setting.icon="fas fa-lock fa-spin";this.text="Logging...";this.meta.content.find('.error-security-login').text('');this.meta.build(this.setting);setTimeout(()=>{this.meta.build(this.setting);this.meta.setting.icon="fas fa-unlock-alt";setTimeout(()=>{initFormMove();},100);},500);}}}}});}
else{initFormMove();}};function initFormMove(){if(order_master.OrderID!==0){let msg=new DialogBox({caption:"Move Table ( "+table_info.name+" )",content:{selector:"#move-table"},position:"top-center",type:"ok-cancel"});msg.setting.button.ok.text="Move";msg.setting.animation.shutdown.animation_type="slide-up";getTableAvailable(0);msg.confirm(moveTable);msg.reject(function(e){this.meta.shutdown();});}
else{let msg=new DialogBox({caption:"Information",content:"Can not move this table...!",position:"top-center",type:"ok",icon:"info"});msg.setting.button.ok.callback=function(e){this.meta.shutdown();};}};function getTableAvailable(group_id){let out="";let tables=$.ajax({url:'/POS/GetTableAvailable',type:'GET',async:false,data:{group_id:group_id,tableid:table_info.id}}).responseJSON;$.each(tables,function(i,table){out+="<label class='rc-container mx1'>"
+"<input data-id="+table.ID+" name='table' type='radio'>"
+"<span class='radiomark'></span>"
+table.Name
+"</label>"
+"<hr/>";});$('.move-table-list').html(out);};function moveTable(){let old_tableid=table_info.id;let new_tableid=0;let tables=$("input[name='table']");$.each(tables,function(i,table){if($(table).prop("checked")){new_tableid=$(table).data("id");}});if(new_tableid!==0){let loader=null;loader=new AjaxLoader("/pos/icons/ajax-loader/loading.gif");$.ajax({url:'/POS/MoveTable',type:'POST',data:{old_id:old_tableid,new_id:new_tableid},success:function(){loader.close();}});this.meta.shutdown();$("#panel-group-items").removeClass("show");$("#panel-group-tables").addClass("show");}else{let info=new DialogBox({caption:"Cannot Move Table",position:"top-center",icon:"danger",content:"Please select any table to move!",animation:{startup:{delay:0,duration:0}}});info.confirm(function(e){this.meta.shutdown();});}};$(".goto-panel-group-tables").on('click',function(){clearOrder();newdefaultOrder();$.ajax({url:'/POS/ClearUserOrder',type:'POST',data:{tableid:table_info.id}});});﻿$("#dbl-void-order").click(function(e){confirmVoidOrder();});function confirmVoidOrder(){let user_privillege=db.table("tb_user_privillege").get('P005');if(user_privillege.Used===false){let dlg=new DialogBox({position:"top-center",content:{selector:"#admin-authorization",class:"login"},icon:"fas fa-lock",button:{ok:{text:"Login",callback:function(e){let access=accessSecurity(this.meta.content,'P005');if(access===false){this.meta.content.find('.error-security-login').text('You can not access ...!');return;}
else{this.meta.content.find('.security-username').focus();this.meta.setting.icon="fas fa-lock fa-spin";this.text="Logging...";this.meta.content.find('.error-security-login').text('');this.meta.build(this.setting);setTimeout(()=>{this.meta.build(this.setting);this.meta.setting.icon="fas fa-unlock-alt";setTimeout(()=>{initFormVoidOrder(dlg);},100);},500);}}}}});}
else{initFormVoidOrder();}};function initFormVoidOrder(dlg){let msg=new DialogBox({caption:"Void Order",content:"Do you want to void this order ?",position:"top-center",type:"ok-cancel"});msg.setting.animation.shutdown.animation_type="slide-up";msg.setting.button.ok.text="Done";msg.confirm(function(e){if(dlg!=undefined){dlg.shutdown();}
processVoidOrder();});msg.reject(function(e){this.meta.shutdown();});};function processVoidOrder(){$.ajax({url:'/POS/VoidOrder',type:'POST',data:{orderid:order_master.OrderID},success:function(status){if(status=='N'){let msg1=new DialogBox({caption:"Cancel Receipt",content:"Please get authorization from administrator to cancel...!",position:"top-center",type:"ok"});}
else{clearOrder();this.meta.shutdown();}}});};